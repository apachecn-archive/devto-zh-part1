# 如何在家用电脑上设置 SSH 服务器

> 原文:[https://dev . to/zduey/how-to-setup-an-ssh-server-on-a-home-computer](https://dev.to/zduey/how-to-set-up-an-ssh-server-on-a-home-computer)

大约 18 个月前，我建造了一台台式电脑，这样当我需要的时候，我的指尖就会有更多的火力。我的希望是避免在 Kaggle 竞赛和其他辅助项目中为云计算服务付费。早些时候，我意识到能够远程使用这台机器会很好，所以我找到了一些资源来将您的家用 PC 设置为 SSH 服务器。然而，我找不到一个单一的资源提供足够的背景信息，我不只是复制/粘贴命令。

虽然设置您自己的 SSH 服务器不需要任何特定主题的高级知识，但是有许多概念可以让您了解。我将在下面解释更多的细节，但简短的版本是，SSH 服务器是在您的计算机上运行的进程，它等待外部计算机通过特定端口请求访问，验证该用户，然后允许访问该计算机。如果这些术语有一半没有意义，不要担心。我第一次尝试被陷害时也是这种情况。以下是我们将涉及的概念/术语的快速列表:

1.  计算机网络服务器
2.  嘘
3.  网络地址转换
4.  公共/私有 IP 地址
5.  港口
6.  端口转发
7.  公钥/私钥认证

我使用 Ubuntu 14.04 LTS 作为我的操作系统，然而，在任何类似 unix 的平台上，步骤都是相似的。要跟进，请确保能够访问以下内容:

1.  将托管 SSH 服务器的基于 unix 的计算机
2.  另一台计算机来测试与服务器的远程连接
3.  访问不同于主机所连接的网络(可选，但推荐)

出于本指南的目的，“主机”是指运行 SSH 服务器的计算机，而“客户机”是指请求访问主机的任何计算机。在本指南中，您的主机也将是客户端。

## 初始设置

SSH 代表“安全套接字外壳”,它允许我们在两台计算机之间建立安全连接。我们的最终目标是能够从客户机发出由主机执行的命令。要更全面地了解 SSH，请看数字海洋的[这本伟大的指南。](https://www.digitalocean.com/community/tutorials/ssh-essentials-working-with-ssh-servers-clients-and-keys)

术语“服务器”经常被不太严格地使用。这里，我们指的是在计算机上运行的进程，其任务是管理通过网络对计算机资源的访问。我们将安装 openssh-server 应用程序，它将允许我们在我们的机器上运行一个 ssh 服务器，该服务器将处理从其他设备访问主机的请求。

从更新您的系统软件包开始:

```
sudo apt-get upgrade 
```

安装 openssh-server 应用程序和客户机。您还应该在将被用作客户机的机器上安装 openssh-client。

```
sudo apt-get install openssh-client
sudo apt-get install openssh-server 
```

现在，您的机器上应该已经运行了一个 SSH 服务器进程。检查以下内容:

```
ps -A | grep sshd 
```

您应该会看到类似这样的内容:

```
[number] ?  00:00:00 sshd 
```

对于那些复制/粘贴了上述命令的人(我确实犯过这样的错误)，通过花时间查找任何您不认识的命令，您将会学到更多。如果您是 shell 命令的新手(或者只是想复习一下),请查看 Code Academy 的[学习命令行](https://www.codecademy.com/learn/learn-the-command-line)课程。

检查您是否可以从主机“登录”到主机，即您的主机在这种情况下也是客户端。

```
ssh localhost 
```

在外壳中稍微移动一下(cd、pwd 等。)以确保一切正常，然后键入“exit”结束会话。

接下来，我们将使用真正的“客户端”机器进行连接。要做到这一点，请确保您的客户机和服务器在同一个网络上。如果你是从家里或工作的 wifi 网络跟随，你应该都准备好了。

首先，通过列出计算机上网络接口的信息来确定主机的 IP 地址。

```
ifconfig 
```

如果您在桌面上安装了无线网卡，您应该会看到“eth0”和“lo”条目，以及其他一些条目。如果您的主机通过以太网电缆连接到网络，请使用与“eth[number]”条目相关的地址。如果您通过 wifi 连接，请使用“WLAN[号码]”条目。如果您只想查看设备的 IP 地址列表，可以使用:

```
ifconfig | grep "inet addr" 
```

接下来，尝试使用该 IP 地址从客户机登录:

```
ssh username@X.X.X.X 
```

应该会提示您输入在 ssh 命令中使用的帐户的密码。出于安全原因，这些字符不会显示在 shell 中。如果成功，你应该会看到一个“欢迎使用 Ubuntu X.X.X”的信息或者类似的信息，这取决于你的操作系统。

这比我们之前的测试有用一点，但是它仍然没有解决我们最初的问题，即能够从同一个网络之外访问机器。如果您有能力将客户机连接到不同于主机的网络，请继续尝试。

如果您的蜂窝网络计划中有少量数据，一个快速的选择是打开网络共享，将您的客户端机器连接到该网络，而您的主机机器保留在另一个网络上。一旦进入这个独立网络，再次尝试 ssh 命令:

```
ssh username@X.X.X.X 
```

很可能，您会注意到命令挂起，然后最终超时。继续并断开与这个其他网络的连接，我们将完成设置的最后一步。但是首先，我们将花一点时间来介绍一些背景概念，这将使下一步更加清晰。

## NAT 和公有/私有 IP 地址

这可能令人惊讶，但互联网在同一时间只能处理有限数量的用户在线。在一个几乎每个电子设备都可以访问互联网的世界里，接近理论上的最大值是可能的。为了解决这个问题，网络地址转换(NAT)应运而生，它允许私有网络上的一组设备共享一个 IP 地址。在私有网络中，每台设备都有自己的私有 IP 地址。例如，您在上面找到的带有“ifconfig”的 IP 地址就是您的计算机在本地网络上的私有 IP 地址。

每当您从家庭网络上的某个设备访问网页时，请求都会通过 NAT 设备进行路由(因此称为路由器)，NAT 设备使用 ISP 分配给路由器的公共 IP 地址将私有 IP 地址转换为请求。这是从本地网络外部连接时最终需要使用的 IP 地址。前往[www.whatsmyip.org](http://www.whatsmyip.org)确定您的公共 IP 地址。您应该会看到类似 XX.XX.XXX.XXX 的内容。您可能会尝试使用这个地址再次运行 ssh 命令，但是很可能仍然无法运行。

虽然 NAT 解决了设备限制问题，但它增加了设置家庭计算机接受 SSH 连接的复杂性。当客户端机器发送连接到公共 IP 地址的请求时，您的路由器不知道该请求是针对您的专用网络上的哪个设备的。幸运的是，解决方案通常很简单，只需要在路由器上设置“端口转发”。请耐心听我说，我们将继续深入术语“兔子洞”并浏览端口。如果您已经熟悉这个概念，请随意跳过。

## 端口和端口转发

虽然电脑有各种大多数人熟悉的物理端口(USB、HDMI、VGA 等。)，我这里指的端口是网络端口，是逻辑端口，不是物理端口。当您启动一个服务器(即您刚刚在前面的步骤中设置的 SSH 服务器)时，您将它绑定到这些逻辑端口之一。然后，该进程“监听”由其他程序(内部或外部)发送到该端口的消息。每个端口都有一个编号，其中一些编号保留给特定类型的服务使用。例如，处理 HTTP 请求的服务器默认使用端口 80。当您通过 URL 访问 web 页面时，您实际上是向端口 80 的 HTTP 服务器发送一条消息，请求由该服务管理的特定资源(web 页面或其他内容)。通常，端口 22 用于 SSH 服务。

在这种情况下，端口转发意味着告诉路由器将使用特定端口发出的请求转发到专用网络上的特定设备。然后由该设备负责处理该请求。您可能想知道:为什么不通过私有 IP 地址直接向计算机发送请求，避免所有这些端口转发的废话？顾名思义，这些 IP 地址是私有的，因此一旦您在不同的网络上，网络普通用户就不知道这个私有 IP 地址，因此连接请求将会失败。在设置端口转发时，每台路由器都略有不同。这听起来像是逃避，但老实说，你最好的办法是查找特定路由器的方向。例如，这里有一个 [AT & T 路由器](https://www.att.com/esupport/article.html#!/u-verse-high-speed-internet/KM1010280)和[康卡斯特 XFINITY](https://www.xfinity.com/support/internet/port-forwarding-xfinity-wireless-gateway/) 的指令。通常，您需要采取以下措施:

1.  登录路由器的管理页面
2.  导航到添加服务的页面(SSH 通常是默认选项之一)
3.  选择或输入将发出请求的端口号(SSH 默认为 22)
4.  选择或输入您之前在主机上找到的私有 IP 地址
5.  保存更新的设置

现在，我们可以使用公共 IP 地址重复我们的 ssh 命令，该请求应该由我们的路由器重定向到我们的主机。重新连接到外部网络，并尝试:

```
ssh username@[public IP address] 
```

应该再次提示您输入主机密码，然后允许您访问。

## 更安全的 SSH 服务器配置

在最后一部分，我们将对 SSH 服务器的配置设置进行一些更改。在 Ubuntu 上，这些设置位于/etc/ssh/sshd_config 文件中。几个小注意事项:

*   要编辑此文件，您需要以超级用户身份打开它
*   每当您更新配置设置时，您都需要重启 SSH 服务器以使它们生效

```
sudo restart ssh 
```

当正在运行的 SSH 服务器通过端口 22(或者它绑定到的任何端口)接收到请求时，它必须检查请求用户是否有访问计算机的权限。这可以通过密码来完成，但是，使用公钥认证被认为更安全。公钥加密的工作原理是让用户生成一个可以给任何人的公钥，同时隐藏私钥。身份验证通过使用公钥(由用户提供给进行身份验证的过程)来验证请求用户(其访问服务的请求是使用其私钥加密的)与被允许访问的用户相匹配。一旦建立了这种连接，就使用更有效的数据加密/解密方法，通过这种安全连接来传输击键和其他信息。

如果您还没有这样做，您将需要生成一个公钥/私钥对，以便在登录到您的机器时使用。请注意，您需要在您希望被允许访问您的 SSH 服务器的任何设备上这样做。有很多好的指南可以帮助你做到这一点，所以为了避免重复发明轮子，我建议按照 [Ubuntu 说明](https://help.ubuntu.com/community/SSH/OpenSSH/Keys#keys-with-specific-commands)去做

现在您已经准备好了这些密钥，我们将在 SSH 服务器上启用公钥认证。以超级用户身份打开 sshd_config 文件，执行下一组步骤，首先更改:

```
PasswordAuthentication yes 
```

到

```
PasswordAuthentication no 
```

这将防止用户使用密码访问服务器，这将有助于防止试图猜测密码的暴力攻击。另一个建议是更改 SSH 服务使用的端口。在您的配置文件中，注释掉现有的端口规范并选择一个新端口。

```
# Port 22
Port [new port number] 
```

请记住，根据前面的步骤，您的路由器仍然会尝试将 SSH 请求发送到端口 22，因此您需要返回到路由器的配置设置，并更新 SSH 服务的端口号。如果您在一台有多个用户帐户的机器上，您还可以限制允许哪些用户通过 SSH 登录。在配置文件的底部添加:

```
AllowUsers [user1] [user 2] ... 
```

您还可以拒绝特定用户和添加/拒绝组，但是，您不太可能需要为家庭计算机执行此操作。

接下来，通过更改以下内容来禁用通过 SSH 的 root 登录:

```
PermitRootLogin without-password 
```

到

```
PermitRootLogin No 
```

除了禁用密码登录，您还可以通过限制 SSH 服务器的并发连接数来防止暴力攻击。对于家用计算机，通过更改以下内容来保持较低的数值:

```
#MaxStartups 10:30:60 
```

到

```
MaxStartups 3 
```

通过 SSH 连接，您可以隧道化图形窗口。如果你不打算使用这种能力，那就通过改变来关闭它

```
X11Forwarding yes 
```

到

```
X11Forwarding no 
```

除了转发窗口，您还可以通过 SSH 转发端口。例如，如果您的主机上有一个运行在端口 80 上的 web 服务器，您可以将该端口转发到客户机上的一个端口。这可能很方便，但是如果你不打算使用这个能力，那么禁用它直到你需要它，因为它可能被恶意使用。

```
AllowTcpForwarding no 
```

ssh_config 文件中还有许多其他设置，但是我不建议更改默认值，除非您有很好的理由这样做。虽然建议的更改会为您的服务器增加一些安全性，但还有许多其他方法可以增加安全性。事实上，他们或许应该有一个属于自己的职位，但我会把这个留到下次再说。

感谢您花时间通读这篇文章，如果有任何不清楚的地方，请随时告诉我。这篇文章最初出现在我的个人博客上。

## 外部资源

*   [数字海洋 SSH 基础知识](https://www.digitalocean.com/community/tutorials/ssh-essentials-working-with-ssh-servers-clients-and-keys)
*   [Ubuntu SSH 配置指南](https://help.ubuntu.com/community/SSH/OpenSSH/Configuring)
*   [Ubuntu 公钥/私钥指南](https://help.ubuntu.com/community/SSH/OpenSSH/Keys#keys-with-specific-commands)
*   [安全 SSH 配置](https://www.maketecheasier.com/secure-ssh-server-ubuntu/)