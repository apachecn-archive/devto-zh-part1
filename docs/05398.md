# 在几毫秒内渲染一个复杂的 Web 应用程序需要什么

> 原文:[https://dev . to/Ben/what-it-take-to-render-a-complex-web app-in-毫秒](https://dev.to/ben/what-it-takes-to-render-a-complex-webapp-in-milliseconds)

在 [dev.to](https://dev.to/) 主页上会发生很多事情，尤其是当你登录的时候。我们加载热门社区帖子，与您关注的标签和用户相关的热门帖子，每个帖子的反应和评论数量，热门标签的信息，您关注的标签，您的个人资料图片，当然，还有与您可能采取的行动相关的所有应用程序代码。

我们做得非常快。

我们相信，对于所有使用网络的人来说，网络几乎是即时的。早期，我从“我们只是提供博客帖子，当然它可以是即时的”的角度来处理这个问题。但是随着平台的发展，我们需要更多的创造力来保持事情的即时性。

## [](#so-what-does-it-take-to-render-an-instant-home-page)那么渲染一个即时主页需要什么呢？

为了尽可能快地将请求发送到世界的各个角落，HTML 请求直接由一个快速的 CDN 节点提供服务。因此，如果您位于纽约市，您的页面将从纽约市获取；如果你在东京，请求将到达东京服务器。如果你在埃及，你的请求将来自迪拜。运营和优化一个全球 CDN 超出了我的专业范围，所以一般来说，我会考虑 CDN 提供的抽象概念。

[![](../Images/4a5a5bcb0002575a6522bd05f97a4263.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--cR_iD9Tf--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/qu464gsxgfuspvzknvqj.png)

这种方法的一个问题是，我们需要保持缓存内容的高命中率，但我们不知道最初的请求是谁。我们使用标题来了解您是否登录，这有助于我们为您组织初始页面并简化我们的一些逻辑；但是，当然，缓存每个唯一登录的用户是不合理的。所以我们发出第二个 ajax 请求来提供定制数据。当您在与 *you* 相关的页面上看到您的个人资料图片或信息时，它是在初始页面加载后加载的。有时这是滞后的，我们总是试图解决它，但典型的经验是坚实的。

[![](../Images/8d45fe615dfcdf22b86b1b07dfc91a2a.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--4WIgeBxU--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/31lpuv2mp2737392qp27.png)

为了尽可能优化您的体验，我们会在本地存储您的部分信息。因此，您在导航栏和主页上的个人资料图片、您关注的标签以及一些其他信息都存储在您的浏览器中，因此无论网络条件如何，这些信息几乎都可以即时呈现。我们仍然每次都向原始服务器发出请求，以进行双重检查并确保信息是最新的。这种方法使得典型的请求比我们不采用这种方法要快得多。

正如我在过去的中所写的那样，消除渲染延迟的很大一部分是内联样式和使所有 JavaScript 异步。这是提供良好体验的重要组成部分。这个决定是不久前做出的，非常棒。

我们过去在每个页面上都采用这种方法，但后来我们改进了我们的方法。

## [](#internal-navigation)内部导航

虽然内联样式是一个很好的选择，可以确保传入的流量获得很好的体验，但在内部导航的每个实例中都发送这些数据并不是最佳选择。我们使用一种基于 XHR 的内部导航形式，类似于 [Turbolinks](https://github.com/turbolinks/turbolinks) ，但是更小并且更加定制化。这提供了一个非常高性能的单页面应用程序的体验，但是大部分逻辑留在了服务器上，我认为这在保持代码整洁和可维护性方面是一个非常大的胜利。

所以我们只在不是由内部导航触发的请求上内联样式。为了更进一步，我们也停止了发送导航栏或页脚。你只能得到页面的内容。然而，后端开发人员不必担心这个选择。他们只需要知道我们不能在不同的页面上有不同版本的导航条(如果不在客户端调用特殊的代码来实现这一点)。这意味着内部页面请求通常约为 4-8kb。这里有一些异常值，比如有很多评论的页面，但是我们也会消除这些异常值。

## [](#progressive-web-apps)渐进式网络应用

集成一些更新的 API 将进一步改善这些方面，这是下一步的工作。我们的缓存优先架构已经准备好利用这些特性，我对此非常兴奋。我们最初的努力是提高每个人的性能，而不管浏览器的特性如何，这使我们能够很好地利用最前沿的 API，这些 API 在浏览器覆盖范围内不断增长，整体上变得更加成熟。

## [](#in-conclusion)总之

我试着运行了一些渲染测试，将 [dev .与](https://dev.to/)和【twitter.com】T2 进行比较，Twitter 一直没有停止渲染。我等了七分钟，测试不会停止。如果这篇文章有任何暗示的话，我没有耐心等待。所以我现在就点击“发布”。我将不得不推断我所拥有的证据，并假设我们的网站比 T4 快得多。

当然，我知道 Twitter 的产品要复杂得多，他们提供的流量比我们多几个数量级。所以我不想在任何工程层面上自夸，但对于任何个人用户来说，他们服务的总流量并不重要。个人仍然会逐个评估用户体验。用户体验就是一切，性能是浏览器用户体验的最大因素。

快乐编码