# 代理是敏捷的敌人

> 原文：<https://dev.to/philgibbs/agents-are-the-enemy-of-agile>

*这篇文章最初发表在 Openmake 软件的[网站](https://www.openmakesoftware.com)上。*

所以你是一个现代软件工厂，你正在拥抱 DevOps。你知道你首先要有一个持续的交付过程。毕竟，如果没有持续的交付，你不能认为自己有一个敏捷的 DevOps 实践。因此，您为您的开发人员设置了一个 CI/CD 过程，并将生成的构建自动推送到 SIT 中。在那里，一些自动化测试运行，构建获得了绿灯(或者视情况而定没有)。

您必须在 SIT 环境中的每台服务器上安装代理，但这并不太繁重——只有 10 台机器。您还设置了监控以确保代理始终在运行。所以没有问题，对吗？

然后有一天你的老板来到你的办公桌前。“我一直在研究 DevOps，”他说，“如果代码通过了 SIT 中的自动化测试，我们应该能够推进到 UAT，对吗？那会节省我们很多时间。"

所以，你笑着说“当然”。但是现在你有一个问题。有几种 UAT 环境，可以部署到其中任何一种。所以现在您有另外 20 台机器可以安装代理。一半是虚拟的，一半是物理的，但是您完成了任务并设置了监控。当然，每当虚拟服务器关闭时，监控就会开始发出警报，因此您停止监控这些服务器。但是，当虚拟服务器启动时，有一半的时间代理无法正常启动——只有当自动部署失败时，您才会发现这一点。

尽管如此，还不算太糟。您现在有 30 个部署代理，其中只有 20 个受到监控，有时由于代理没有运行，虚拟化 UAT 环境中的自动部署会失败。但总而言之，你可以忍受。

然后你被叫去开会。UAT 团队决定将所有东西都转移到云上。这将使他们更加灵活，因为他们可以在任何需要的时候启动服务器，以应对因所有新版本需要测试而增加的需求。当然，每台虚拟化的基于云的服务器都需要安装一个代理，但你可以应付，对吗？

因此，您在每个虚拟化服务器上安装代理，编写 PowerShell 命令在启动时加载代理。当然，在代理启动并运行之前，部署到这些环境中是不可能的，所以这个过程会慢一点，但它仍然是敏捷的，对吗？

然后您的部署工具得到升级。这就需要对所有的代理进行更改。你还有几个？它们安装在哪里？

尽管如此，你还是掌握了全局。你有一个体面的 DevOps 的做法。现在您需要的是从持续交付到持续部署的最后一击。一旦完成，您就达到了 DevOps 成熟度模型的顶端，并且自动化部署已经进入生产阶段。

所以你去找生产支持部。您解释说，您想要在他们的任务关键型服务器上安装一个软件，该软件可以对机器上的任何生产软件进行更改。它是一个黑匣子，所以你不知道它通过什么协议通信，也不知道它是否安全。10 分钟后，你离开会议室时，耳朵还在嗡嗡作响。

因此，您将永远无法实现连续部署，因为您无法将部署自动化到生产环境中。但是，嘿，你仍然有一个敏捷的解决方案，对不对？

然后决定外包 IT 基础设施。现在你不再运行 Windows Server 2012 和 RedHat Linux。现在你在 Windows Server 2016 和 Oracle Linux 上。该代理与 Oracle Linux 兼容吗？你给供应商打了个电话，他说应该可以用(Oracle Linux 就是 RedHat，对吧？)但是没有认证。所以如果因为任何原因失败了，你就不走运了。

作为这种转变的一部分，还决定安装 DataPower 来实现负载平衡。配置变更需要作为部署过程的一部分交付给 DataPower。当然，没有像 DataPower 这样的 Web 设备的“代理”这样的东西，所以这些更改必须手动应用。这种变化需要与自动化软件交付过程相协调。但是有了电子表格和电子邮件，应该可以建立一些不那么糟糕的东西。

然后一个新的首席软件架构师加入进来。他年轻有野心，喜欢微服务和容器的声音。因此，他决定启动一个项目，将单一的代码库分解成一堆存放在不同容器中的微型和迷你服务。开发人员喜欢这个想法(在他们的简历上看起来很棒！)现在，您的部署需要潜在地面向许多不同的 Docker 容器。可以在容器中安装代理吗？这可行吗？

此时，您仔细审视了您的新基础架构及其负载平衡器和容器，以及物理、虚拟和基于云的服务器组合，并认为您的这些部署代理确实是个糟糕的主意。

## 特工是敏捷的敌人

如果这个噩梦对你来说很熟悉，你并不孤单。代理是敏捷的敌人。它们限制了可以在哪里以及在哪个平台上执行部署。他们需要监测，以确保他们是可操作的。它们需要更新。它们需要安装在每个目标上，甚至是基于云的服务器。一些云提供商有自己的部署解决方案，您需要集成这些解决方案，以使您的代理变得无用或最终受损。最糟糕的是，很难说服生产支持人员允许将它们安装到生产环境中。这意味着，您不仅需要在需要自动化、可重复、受控和审核流程的环境中执行手动部署流程，而且您将永远无法实现持续部署，而这正是 DevOps 的首要目标。

使用代理的应用发布自动化解决方案也倾向于收费。通过许可每个部署端点来销售工具并不罕见。当您部署到物理服务器时，这是可以接受的。但如今，网站正在转向容器和基于云的基础设施，以允许它们加速运行潜在的数百台服务器来满足短期测试高峰。使用代理的许可模式跟不上那种敏捷测试过程。

这就是为什么现代 ARA 解决方案不用代理的原因。在 SSH 或 FTPS 等开放协议上运行还有许多其他优势:

港口已经开放了。与部署目标通信时，通常不需要更改防火墙。

您可以部署到生产环境中，因为为管理生产服务器而打开的端口就是用于部署变更的端口。现在，无需在生产服务器中安装“黑盒软件”,连续部署就成为可能。

您可以将任何操作系统作为目标，只要它在这些开放协议上运行。想要从单个 ARA 解决方案部署到大型机、iSeries、Linux、Windows、OpenVMS 和 Tandem？然后选择一个没有代理的工具。

想通过 RESTful 或基于 SOAP 的 API 对 WebAppliance 进行配置更改吗？没有代理，没有问题——通过 API 交付变更，并将其记录为成功的组件交付。

## 结论

部署代理与敏捷开发和测试方法不兼容。由于损害了提供持续部署的能力，他们也是开发运维的敌人。简而言之，如果你想实现敏捷的全部潜力；如果您想要实现一个成熟的 DevOps 解决方案，并持续部署到生产环境中；如果您想降低成本和减少停机时间，那么-[失去您的代理](https://www.openmakesoftware.com/agentless-release-automation/)。