# 内容性能政策，AMP 的替代方案？

> 原文:[https://dev . to/damienjubeau/content-performance-policy-an-alternative-to-amp](https://dev.to/damienjubeau/content-performance-policy-an-alternative-to-amp)

*这篇文章最初出现在 [Dareboost](https://www.dareboost.com/) 的博客上。*

*自 2016 年 8 月以来，内容绩效政策并没有什么真正的新意。尽管如此，考虑到最近几个月关于 AMP 的[讨论](https://twitter.com/molily/status/866697258976366592)和声明，例如[在谷歌 AMP 杀死网络](https://www.theregister.co.uk/2017/05/19/open_source_insider_google_amp_bad_bad_bad/)之前杀死它，我认为* **内容表现政策值得一些关注** *！*

* * *

你可能已经知道[内容安全政策](http://blog.dareboost.com/en/2016/08/content-security-policy-secure-your-website/)。这是一个很好的功能，可以为你的网站增加更多的安全性，尤其是保护你的访问者免受 XSS 攻击的影响。
CSP 背后的想法是允许网站所有者提供一个安全策略，下一步将由网络浏览器应用。例如，它允许显式地将一些 JavaScript 文件列入白名单，或者确保使用 HTTPs 来请求页面中的每个资源。
[Tim Kaldec](https://timkadlec.com/2016/02/a-standardized-alternative-to-amp/) 和 [Yoav Weiss](https://blog.yoav.ws/) 借用了 CSP 的一般概念将其应用于 web 性能主题，提出了一个新的 HTTP 头(内容性能策略)**允许精确声明给定页面与一些 web 性能最佳实践的符合性级别**。然后，用户代理将负责确保所宣布的最佳实践的有效性。这是一种由网站向网络浏览器发出的 SLA，用户代理将保证即使这意味着代理自己的默认行为。
示例:我的网站向用户代理宣布(通过 *no-blocking-font* 指令)页面内容可以显示，无需等待下载字体文件。如果这不是真的(所以这个指令是不准确的)，用户代理应该绕过它的默认行为，在下载字体文件之前开始显示文本内容。
在这篇文章中，我的目标是(通过对 Tim Kaldec 的文章的总结)提供一些关于内容性能策略背后动机的背景知识，当然是谈论 spec 提案(即使它还处于非常早期的阶段)，并且至少关注我们当前可能面临的内容性能策略的限制。
事实上，在 Dareboost 团队中，我们致力于提供一个尽可能可靠的诊断工具来检查是否符合性能最佳实践(以及其他)，因此我们的观点并不是真正的经典观点。

## [](#why-a-content-performance-policy-)为什么要有内容表现政策？

我们还没有在这个博客上讨论这个话题，但是如果你在 Twitter 上关注我们(如果没有，[是时候这样做了](https://twitter.com/DareBoost)！)，你肯定知道:谷歌最近转移了与[加速移动页面项目](https://www.ampproject.org/)的路线。
这是一个构建移动网页的框架，专注于速度和用户体验。谷歌推动事情向前发展，[在搜索结果中突出显示使用该技术的网站](http://searchengineland.com/google-to-launch-amp-in-search-results-february-24-2016-242902)。Tim Kaldec 对此评价很高:AMP 是一项伟大的技术，这个项目也是。但是 Google 推广了一种技术——尽管 AMP 根本不是构建快速体验的唯一解决方案，但它只是其中一种方法。
Tim 继续他的分析，提到 Google 这样做实际上是为了方便自己的工作。几个月前，我在这篇关于红色慢速标签的文章中提出了这个问题:很难确定一个网站是慢还是快，因为你需要考虑很多参数。
此外，红色慢速标签和[慢速加载](https://blog.dareboost.com/en/2015/06/google-slow-to-load-ongoing-test/)均未达到 SERP。突出 AMP，Google 实际上简化了等式:使用它的网站被认为速度很快，所以它们被推广。接下来是世界上的其他地方……
这里有一句蒂姆的名言，我觉得这句话特别聪明:

> 因此，当我们看到 AMP 提供了哪些你还不能提供给自己的东西时，它并不是一个高性能的网站——我们完全有能力做到这一点。就是这个验证。

就我个人而言，我仍然对谷歌通过采用这种技术所取得的成就印象深刻，这无疑有助于拓宽人们关注网络性能的领域。但也许是出于不好的原因？

液体错误:内部

Tim Kaldec 和 Yoav Weiss 致力于寻找一种解决方案，带来类似的验证潜力，允许推广具有良好用户体验的快速网站，而不产生对特定技术的依赖。因为我们需要保持网络的开放性和多样性。
就这样[内容表现政策](http://wicg.github.io/ContentPerformancePolicy/)诞生了！(如果看起来 [AMP 团队已经在做类似的事情](https://timkadlec.com/2016/02/a-standardized-alternative-to-amp/#comment-2533868150) )
因为使用的框架或任何技术都不能像 AMP 一样保证良好的性能，这应该是用户代理的角色。一个网站正在宣布它遵守的最佳实践是什么。如果网站违背了承诺，浏览器将不得不强制执行。

## [](#content-performance-policy-a-good-solution)内容表现政策，好方案？

我们总结一下:

*   谷歌对众多依赖有机流量的网站所有者强制执行网页性能，因此要求采用 AMP，以便从搜索结果中推广这一技术中受益
*   内容绩效政策并不违背提升速度的理念，它甚至可能认识到搜索引擎带来的正面压力的好处。然而，CPP 的想法是提供一个替代只有放大器的世界。Â
*   AMP 是谷歌和网站之间的交易，而内容性能政策将用户代理供应商加入团队，因为用户代理将为网站的承诺担保

当然，在 Dareboost 团队中，我们非常热衷于发现这些伟大的想法！我们 100%同意这种方法以及除 AMP 之外的其他东西的需要。

谷歌处罚慢速网站一直是我们的问题，提出了很多问题。我们自动检测了许多 web 性能问题，比大多数工具都更进一步。我们还对网站的大样本进行了基准测试，以了解更多关于性能的信息。这就是为什么我们也希望通过这篇文章表达我们的观点，即使我们更习惯于谈论最终的建议。Â

### [](#stakeholders-interdependencies)利益相关者相互依存

第一个可能值得关注的困难可能是考虑采用 CPP 的三方之间的狭窄关系:搜索引擎、用户代理供应商和网站所有者。如果没有搜索引擎的激励，CPP 可能会停留在网络性能世界，一个有趣的工具，但不会像 AMP 一样帮助推动速度达到一个新的水平。
如果没有网络浏览器的实现，CPP 根本就不是一个验证信号，因为没有什么能迫使网站遵守他们的承诺。
如果没有网站所有者的广泛采用，这将导致许多没有使用该机制的快速网站受到惩罚。Â

### [](#speed-or-nothing)速度还是虚无？

阅读[指令列表](http://wicg.github.io/ContentPerformancePolicy/#directives)(2 月 25 日)，我们可以假设理解内容性能策略需要一些关于各种主题的高级知识。
听起来这可能会阻碍领养过程。你不仅要明白它是关于什么的，还要明白风险是什么，尤其是违反指令会导致什么后果。
使用 CPP 也意味着重要的维护工作。今天，一个错误正在拖慢你的网站。例如，你可以使用一个像 Dareboost 这样的[网络性能监控工具](http://www.dareboost.com)来检测速度的下降。).使用 CPP，一个错误可能意味着你的网站将不再工作！(例:我的网站承诺是加载 800ko 以内。例如，如果通过 CMS 添加了一个沉重的图像——因此直接在我的工作流程之外的生产中——网络浏览器将阻止数据溢出，以保持我的网站遵守它的承诺。如果块内容是必不可少的 JS 或者 CSS 怎么办？)
CPP 的一些障碍类似于我们在内容安全策略采用方面遇到的障碍。如果你向你的团队提供 A/B 测试或者标签管理器解决方案，你在生产的任何时候都有可能违背承诺。这可能会导致你的网站瘫痪，因为浏览器的工作就是保证承诺。
能够约束第三方内容，很有意思。然而，对于性能问题，我认为在选择服务时，这是你必须尽快做的事情。使用 CPP 这样做，由于更新，随时看到一些第三方内容代理的风险很高。
Yoav 回答:

> “我不知道它会是什么样子，但我们计划建立一些机制，将影响限制在某些主机上。”[提案已经更新](https://github.com/WICG/ContentPerformancePolicy/pull/11/files)

### [](#finding-a-common-reference-basis)寻找共同的参考依据

最后但同样重要的是，我们如何确定每个指令的重要程度？如何确保我们在列表中有足够的指令来合理地确认一个页面足够快？即使我们成功了，建立阈值(资源限制、最大内部阻塞大小)也将是困难。避免更多的复杂性是绝对需要的，希望网站所有者采用。因此，这意味着所有使用 CPP 作为验证机制的参与者(浏览器、广告拦截器、搜索引擎等)都有一个共同的阈值基础。正如 Yoav 所指出的，此事将被考虑在内([见 github 问题](https://github.com/WICG/ContentPerformancePolicy/issues/10))。
正如 AMP 团队提醒的，我们不必忘记，今天慢的[东西，明天不一定慢](https://paulbakaus.com/2016/02/26/life-after-amp/)，所以这个基础应该是可以进化的。这种方法仍然很棒，很高兴看到人们提出这种惊人的想法。
我认为 CPP 需要为每个指令提供更多的控制，以便能够做出包括或排除一些资源的承诺(以防止在承诺被破坏时破坏任何重要的东西)
在我看来，明确区分由用户代理执行的没有重大后果的承诺(例如:不自动播放，不阻止字体)，那些有风险的承诺，以及那些不能由浏览器合理执行的承诺(例如:max-internal-blocking-size)可能会很好。

* * *

也许是时候给 CPP 一个新的开始了？欢迎[参与提案](https://github.com/wicg/ContentPerformancePolicy/)。