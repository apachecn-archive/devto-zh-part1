# 单元测试写作的风格

> 原文：<https://dev.to/vorahsa/styles-of-unit-test-writing>

我花了很长时间才适应单元测试，以至于我可以把它们看作是我平常开发过程的一部分。回顾过去，我可以确定学习写作的四个不同阶段，并欣赏它们。我将称它们为*风格*:

1.  无测试开发
2.  最后测试开发
3.  测试优先开发
4.  测试驱动开发

我从无测试开发开始。我不会为任何事情编写单元测试，只是依靠我的能力来记住整个代码库并理解什么影响什么。这不是很好的扩展。但是有了好的测试人员和干净的架构，我们可以让它在某种程度上工作。

测试后开发对我来说是“我应该写单元测试，但是我不明白为什么”的阶段。我会编写代码，然后编写一个庞大的测试函数，一个接一个地测试它的每个特性。当然，有时一个测试的中断表明了一个问题，但是找出到底哪里出了问题并不总是很容易的。

当我开始阅读更多关于好的单元测试实践时，测试优先开发开始了。我开始把我庞大的测试分成单独的测试。我学习了排列-动作-断言结构。我开始尝试先写一个测试，然后写代码让它通过的方法。对我来说，这感觉更自然，在确保所有东西都经过测试的同时，增量地实现功能。

对我来说，测试驱动和测试优先开发之间的区别在于 API 设计发生的时间。在测试优先开发中，我仍然在编写测试之前设计被测试组件的 API。测试驱动的开发更具探索性。我还不知道什么是好的 API，所以我把测试作为未来 API 的客户来探索设计空间，并找出什么是自然使用的。

这些是我在学习编写单元测试的好方法时所经历的阶段。但这并不意味着当我适应了一种新的风格后，我就放弃了早期的风格。我认为每种风格在适当的情况下仍然适用。不同的是，现在，选择合适的风格是一个有意识的决定，而不仅仅是发生了什么，学习其他风格帮助我编写更干净的代码，即使我没有特别应用那些风格。例如，即使我在编写代码时进行最后测试而不考虑测试，代码最终还是相当可测试的。

不写测试是完全合理的。即使不是不适合单元测试的东西，比如 UI 或数据库访问代码，我通常也不会为不太可能改变的简单功能编写测试。这也是我练习考末式的常用方式。一个我认为简单的函数开始积累复杂性到需要测试的程度。所以在这种情况下，我在写完代码后写测试。

大多数时候，我都是以测试优先的方式工作。真正的新情况不会经常遇到，所以通常我很清楚 API 会是什么样子，可以开始写测试了。我更喜欢先测试后测试，因为为每一个增量功能编写小的测试可以确保所有的东西都被测试，这给我一种进步的感觉，这是我在编程时一直渴望的。

但是有时我只知道我需要的功能，而不知道应用程序的其他部分应该如何调用它。这通常发生在我编写一些更通用的模块时，这些模块不是特定于应用程序的，可能会变得非常复杂。在这种情况下，测试驱动的风格对我来说非常有效。我一点一点地实现模块，这样我就可以专注于设计每个小增量的最佳方式。在这种工作中，TDD 的重构步骤对于保持代码的整洁来说确实是强制性的，因为模块 API 及其内部往往会不断变化。