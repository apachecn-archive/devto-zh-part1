# 更快的网络渲染速度

> 原文:[https://dev.to/ben/faster-rendering-on-the-web](https://dev.to/ben/faster-rendering-on-the-web)

我一直认为外部 CSS 文件是 web 开发中的最佳实践。然而，这看起来确实有点反直觉。为什么我们要为一个页面获取 HTML，然后等待另一次往返以获取样式，处理过程中涉及的所有握手和延迟，然后最终呈现一个页面。延迟始终是一个限制因素，但在不一致的网络条件下，这一问题尤为突出。即时性是互联网和万维网的杀手锏，通过对我们的过程施加一些约束，我们可以让它更频繁地发生。

像谷歌工程师伊利亚·格里戈利克这样的性能倡导者已经做了很多演讲，倡导其他的实践，比如内联关键 CSS，以大幅加快渲染时间。很多组织很好地利用了这些想法，但在我看来，许多个人开发者并没有太重视这些想法。想到像 [HTTP/2](https://http2.github.io/) 这样的新规范会颠覆我们当前的一些优化工作，也会让人感到麻痹。然而，我认为，通过关注渲染阻塞延迟是一个可以避免的抑制因素的一般概念，新的规格将更容易被采用。像[服务器推送](https://blog.cloudflare.com/announcing-support-for-http-2-server-push-2/)这样的 HTTP/2 特性将会是你现在想要考虑的一个选项，但是浏览器和服务器支持可能会让你很不舒服地处于风口浪尖，我认为不致力于这个过程也能获得很大的收益。

我们使用外部 CSS 文件是为了让浏览器缓存我们的资产并简化我们的工作流程。我认为在很多情况下，缓存样式表是有益的，但是在很多合法的情况下，用户会失去这些好处。当用户第一次访问你的页面和任何时候你改变你的 CSS 文件时，他们需要支付一大笔前期费用。这些绝不是边缘案例。如果你想确保每次都有很好的用户体验，你应该尝试让每一个页面都有即时的感觉。

解决工作流问题:我采取的方法是将所有 CSS 写入外部文件，然后通过编程将关键的 CSS 包含在头部的`<style>`标签中。这将根据您的服务器端环境以不同的方式完成，但确保我不会重复自己，并采用一种在涉及到协作时可以更容易解释的编程流程。非关键的 CSS(可能被认为是“文件夹下”的内容)应该是“异步的”，这样它们就不会阻碍页面的呈现。

CSS 的这种异步是一种“反模式”,如果不进行明目张胆的黑客攻击，你甚至无法实现它。但这是一个不会增加大量复杂性或债务的黑客，所以它是值得的。有几种方法可以实现异步，但是我的方法是在样式表链接中添加一个假的媒体属性，链接到任意一个字符串，比如“butthead”。您可以使用除“全部”、“打印”、“屏幕”等功能关键字之外的任何字符串。

```
<link 
  rel="stylesheet" 
  media="bogus" 
  href="styles.css" 
  onload="if(media!='all')media='all'"
/>
```

对于渲染时间对用户体验有重要影响的任何页面，我们应该尽可能消除延迟负担。有各种项目和规范致力于解决这些问题。谷歌的[加速移动页面项目](https://www.ampproject.org/)明确加强了内联 CSS 的约束，看看它会对网络的未来产生什么影响将会很有趣。HTTP/2，所有未来的规范也将继续改变许多“最佳实践”。“离线优先”方法也有一些进步，值得关注。所有这些都可以在适当的时候加以利用，但是不要觉得为了优先考虑性能而需要学习所有这些，尤其是如果这会使事情变得复杂的话。最好的优化几乎不会增加复杂的开销。关注一些关于延迟的基本常识性原则将有助于您现在获得大量收益，并让您有意识地做出正确的决策。

消除资产往返可能是思考一般性能的入门药。如果你觉得这东西有趣，你可以学到很多东西。然而，兔子洞很深，我们不希望“过度优化”或“过早优化”并引入使与其他开发人员沟通困难的开销。通过在你的项目中采用一些高层次的约束，这些优化将成为你工作流程的一个赋权部分，而不是一个复杂的部分。

## 最后一件事

应用程序的前景正在破裂，本地 vs web vs bots vs .任何争论都将激烈进行。这可能会让你不太关心具体的网站优化策略，但我认为这是一个机会，可以让你把“网站”的重点放在网站的目的上，正如我之前提到的，即时性。我们对网络的即时性有所期待。大多数开发人员不管他们的专业是什么，都会建立一两个网站，学习实现平台的主要目标对任何开发人员来说都是一项充实的工作。