# 重构并不可怕

> 原文：<https://dev.to/spalonytoster/refactoring-not-so-scary>

### 什么是重构？

这个问题的答案对你理解整个过程非常关键。*重构*是改变代码的*结构，而不是改变*功能*。
对了我刚才说**流程**了吗？是的，因为这是一个持续的过程，我们经常忘记这一点。最近，我问了我公司的一个程序员同事*“那么你如何将你的开发过程与重构相结合？”*。他说*“每次冲刺之后，我们都有时间进行重构”*。那么，为什么这是一种不好的做法呢？因为在一个完整的 sprint 之后，你没有像你为每个功能编码时那样多的上下文。你必须:阅读代码，理解代码，切换到其他功能，重复。想想当你在编写新的东西的时候做这件事会有多有效。
所以再一次，*重构*是一个你应该并行应用于编写代码的过程！*

### 我们为什么要重构？

答案很简单——**重构节省未来成本**。
每个越来越大的项目也越来越复杂。如果代码质量与复杂性不同步，每个人都会花更多的时间去阅读它。即使对于新的 greenfield 项目，写/读代码的比率可能是 30%/70%(在更大的项目中，它可能上升到 5%/95%)。如果你考虑这 70%的优化，并乘以团队成员的数量，它可能会导致巨大的节省。现在，难道你不认为让你的代码更易读在将来会有很大帮助吗？

### 我如何重构？

假设您正在实现一个新特性，并且刚刚编写了一个处理一些操作的新类。随着班级越来越大，你会看到更多的缺点。你怎么能发现他们？干净的代码拯救世界！

*   **函数长度**大约应该是 7-20 行代码。不会了。在某些特定的情况下，你无法做到这一点，但是当你发现一些可以被命名的代码行时，就把它们提取到一个新的函数中(你不必计算 *if* 、 *while* 等)。作为整行，只是他们的身体)。

*   **函数参数**应为*约为*取 3 个参数。理想情况下，你需要*零个*参数，所有数据都来自类的属性。这并不总是可能的，所以至少尽量不要超过 3 个。

*   **类长度**应该是大约 150 行代码。为什么？因为这很可能打破了固的[单一责任原则](https://en.wikipedia.org/wiki/Single_responsibility_principle)——一个类只应该做*一件*事情，并且应该做好。

*   **压痕**应该大约有两层深。为了清楚起见，让我们给你看一个例子:

```
public void doSomething() {
    while(conditionIsMet()) {
        if (anotherConditionIsMet()) {
            doSomeLogic();
        }
    }
} 
```

不要超出这个范围，你就可以走了。当你要更深入的时候- **提取**到函数！

*   如果你的函数名里非要用*和*这两个字，那就是有问题了。再一次的[单一责任原则](https://en.wikipedia.org/wiki/Single_responsibility_principle)的稳固。

*   **提取到变量和函数**每次你都可以提供一个关于其用途的明确信息。尤其是将循环体提取到函数中，将数字/字符串文字提取到常量中！

之前:

```
 product.grossValue = product.price * 1.23; 
```

之后:

```
product.grossValue = calculateGrossValue(product.price);

public double calculateGrossValue(int productPrice) {
  return productPrice * PRODUCT_FEE;
} 
```

*   **通过提取简化条件**。与上一个类似，但现在我们的目标条件是 *if* 、*，而*、 *for* 语句等。

在这个特定的场景中，很容易看出 *if* 语句的条件是什么

```
if (!inventory.cars.isEmpty()) {
  doSomething();
} 
```

但是这样不是可读性更强吗？

```
if (carsInInventoryNotEmpty()) {
  doSomething();
}

private boolean carsInInventoryNotEmpty() {
  return !inventory.cars.isEmpty();
} 
```

*   **绝不**允许代码重复！如果一个地方发生了错误，你必须覆盖其他地方，很可能你会错过其中的一个。相反，寻找一个你可以提取的智能抽象。[设计模式](https://sourcemaking.com/design_patterns)非常有助于摆脱困境。

*   **不要用注释**。相反，尽量给你的函数和变量起一个更好的名字。只允许对 **TODO** 、 **FIXME** (虽然不在主分支上)以及一些你想描述你的意图而不是机制的特殊情况进行评论。

这些是我保持代码整洁有序的经验法则。你可以在鲍勃叔叔的书中或互联网上的许多其他资源中阅读更多关于其他规则的内容。
看看[重构目录](https://refactoring.com/catalog/)和更多的工具来让你的代码变得更好也是很好的。此外，大多数基本的重构应该在您的 IDE 中可用。尽可能地使用它，因为你的 IDE 是智能的，如果它会破坏任何东西，它不会让你重构！

### 总结

重构的想法并不是让每件事一次都完美。相反，你想做许多对你的代码有积极影响的小改变。每次你做出改变时，问问自己:*对我和其他可能遇到这种情况的人来说，它是否更具可读性？*如果答案是*是*，那么你应该留着它。
记住，你毕竟是为人类而不是机器编写代码。是的，你可以有所作为:)祝你好运！

你对这个话题有什么想法？在评论中分享你的最佳实践吧！