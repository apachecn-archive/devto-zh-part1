# 关于捕获 Web 应用程序的数据耗尽的注释

> 原文：<https://dev.to/horia141/notes-on-capturing-the-data-exhaust-of-a-web-application-255p>

web 应用程序的服务器端部分的“经典”观点是，它由一堆 web 服务器、数据库服务器、缓存等组成。基本上，一组运行应用程序代码的组件，和一组应用程序代码使用的数据存储组件。这与你在整体服务微服务无服务器应用架构中的位置无关。

关于数据存储组件有趣的事情是，因为没有更好的词，它们是*活动的*。我的意思是应用程序是负责管理数据的人。想想书店这个经典的例子。图书库存服务会将图书标记为售完，记录图书何时售出等。

但是应用程序所依赖的数据组件还有另外一个非常重要的类别。应用程序生成*动作日志*、*异常日志*和*指标*。它们一起构成了 [*数据排气*](https://en.wikipedia.org/wiki/Data_exhaust) 系统的一部分。

动作日志通常来源于网络日志，但通常更加结构化。它们不需要从网络日志中获得 T1，因为不是所有的服务都是 HTTP 服务器。因此 gRPC、Thrift 甚至定制的东西都可以生成它们。请求和操作日志之间也不必一一对应，尽管这通常是最有意义的。最大的区别是您可以在日志中添加应用程序级别的信息。

这些日志通常用作应用程序执行的所有操作的记录，用于分析、数据挖掘和机器学习，当然也用作监控和警报的来源。所以它们需要耐用并且不会丢失。它们有特殊的系统。可以暂时使用 SQL 数据库之类的。但通常像 ELK stack，或 Loggly，Splunk，或 GCP/AWS 内部提供的东西是人们在生产中最常用的。

转到下一种类型的日志。当应用程序运行时，它们会遇到异常。有些是意想不到的，有某种最后的处理程序来处理它们。这些更多的是设计错误。想象一下有人没有考虑 RPC 可能失败或者调用可能返回 null 的事实。预计还会有一些，但是应用程序不知道下一步该做什么，所以它决定放弃，只记录它们。例如，如果一个 API 调用需要被认证，但是无法联系到认证服务。最后，一些特殊情况需要这样的记录，即使应用程序可以恢复。

这些日志用于调试和跟踪应用程序的问题。它们不需要比异常发生的时间更长，但是在实践中通常也是持久的。他们有专门的系统，通常集成了项目管理工具、bug 追踪器、Slack 等等。定制系统是常见的，但滚动条，或 GCP/AWS 内部提供也很常用。

最后，还有指标。这些是应用程序运行时生成的时间序列类型的数据，通常测量内部属性，通常与性能相关。QPS、延迟等。都是要处理的常见事情。

这些指标通常用作监控和警报的基础，以及服务的概览仪表板。他们又有了特殊的系统。ELK 在这里很常见，TSDB 专门用于数据，以及 GCP/AWS 内部提供。

这里有一些共同的模式。通常在这些系统的核心有一个定制的非 SQL 数据存储。它适用于相对非结构化的数据，这种数据通常是写的比读的多。除此之外，还有一堆分析工具，与其他系统的集成等等。这些系统更多的是面向生产而不是开发。尽管它们包含在开发设置中，但集成是不确定的。最后，作为一个商业问题，公司似乎很乐意使用第三方托管服务来完成这些任务。比 SQL 服务更重要。