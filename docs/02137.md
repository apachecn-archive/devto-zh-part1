# 代码重构技术

> 原文：<https://dev.to/apium_hub/code-refactoring-techniques-4pp>

代码重构是[软件开发](/)中的关键术语之一，今天我想谈谈可能会提高你效率的代码重构技术！

但首先，让我们就什么是代码重构达成一致！基本上，代码重构是在不修改程序外部功能行为的情况下改变程序源代码的过程，目的是改进软件的一些非功能属性。换句话说，代码重构是澄清和简化现有代码的设计，而不改变其行为的过程。如今，[敏捷软件开发](https://apiumhub.com/tech-blog-barcelona/benefits-of-agile-project-management/)几乎是必须的，[敏捷团队](https://apiumhub.com/software-developer-jobs-barcelona/)在一次次迭代中维护和扩展他们的代码，如果没有持续的重构，这很难做到。这是因为未重构的代码容易腐烂:类或包之间不健康的依赖关系，类责任的不良分配，每个方法或类太多的责任，重复的代码，以及许多其他种类的混乱和混乱。因此，优点包括提高代码可读性和降低复杂性；这些可以提高源代码的可维护性，并创建更具表现力的内部架构。

最近在软件开发中最有影响力的两个人，Martin Fowler 和 Kent Beck 写了一本关于重构的书，名为“[重构:改进现有代码的设计](https://martinfowler.com/books/refactoring.html)”。强烈推荐你看，绝对值得！

这本书描述了重构的过程，并花了大部分时间解释如何进行各种重构——行为保持转换。在这本书里你会找到描述整个过程的简单例子。围绕重构还有更广泛的问题，暗示重构的“代码味道”，以及测试的角色，这些你也会在本书中找到。我最喜欢这本书的一点是，它详细描述了 70 种重构和代码重构技术:做它们的动机、如何安全地做它们的机制以及一个简单的例子。一个常见的问题是这本书是否仍然相关，这是一个很好的问题，因为技术已经取得了许多进步，但是根据我们在 Apiumhub 的经验和其他软件开发人员的意见，这本书仍然非常有用。例如，本书中描述的代码重构技术没有改变，因为它们是编程语言基本用法的一部分。你应该读它的另一个原因是，它是由我们这个时代的传奇人物写的，是由实际上首先尝试它并发展了这个概念的人写的！还有其他关于这个主题的有趣的书，你可以在这里找到它们，但是这本书是最重要的。

## 正确使用代码重构技术的一些技巧

*   代码重构应该作为一系列小的改变来完成，每一个改变都使现有的代码稍微好一点，同时仍然让程序保持正常工作。不要把一大堆重构混合成一个大的改变。
*   当你进行重构时，你一定要使用 [TDD](https://apiumhub.com/tech-blog-barcelona/advantages-of-test-driven-development/) 和 [CI](https://apiumhub.com/tech-blog-barcelona/benefits-of-continuous-integration/) 来完成。如果不能在重构的每一小步之后都运行这些测试，你就有引入 bug 的风险。
*   代码应该变得更加清晰。
*   重构期间不应创建新功能。不要把重构和新功能的直接开发混在一起。尝试至少在单个提交的范围内将这些过程分开。

## 代码重构的好处

**1。看到整个画面**

如果你有一个主要的方法来处理所有的功能，它很可能会太长而且非常复杂。但是如果把它分解成几个部分，就很容易看出真正在做什么。

**2。让你的团队看得懂**

让你的同事看得懂，不要为自己写，要从长远考虑。

**3。可维护性**

更新和升级的集成是一个不可避免的连续过程，应该受到欢迎。当代码库是无组织的，并且建立在薄弱的基础上时，开发人员通常会犹豫是否进行更改。但是通过代码重构，有组织的代码，产品将建立在一个干净的基础上，并为将来的更新做好准备。

**4。效率**

代码重构可能被认为是一种投资，但它获得了良好的结果。您减少了您或其他开发人员对代码进行未来更改所需的工作，从而提高了效率。

**5。降低复杂性**

让你和你的团队更容易地完成项目。

## 主要代码重构技术列表

有许多代码重构技术，我不想一一介绍，因为这篇文章最终会成为一本书。所以，我决定[挑选](https://refactoring.guru/refactoring/catalog)我们觉得最常见和最有用的。

**红绿重构**

我们先来简单说一下非常流行的红绿代码重构技术。红绿重构是支持测试驱动开发的敏捷工程模式。其特点是“测试优先”的设计和实现方法。这为所有形式的重构奠定了基础。通过从失败的“红色”测试开始，编写尽可能简单的代码以通过“绿色”测试，最后在保持测试“绿色”的同时改进和增强您的代码，您将重构纳入测试驱动的开发周期。这种方法是关于如何无缝地将重构集成到你的整个开发过程中，并努力保持代码的整洁。这有两个不同的部分:编写向系统添加新功能的代码，以及改进执行该功能的代码。重要的是要记住在工作流程中不要同时做这两件事。

作为一名开发人员，你可以对你的代码库做一些事情来使你的下一个特性的构建变得更加容易。马丁·福勒称之为预备重构。这也可以使用上述红绿技术来执行。预备性重构还可能涉及到偿还在特性开发的早期阶段积累的技术债务。尽管最终用户可能不会与工程团队在这些工作上达成一致，但是开发人员几乎总是欣赏好的重构实践的价值。

**通过抽象进行分支重构**

抽象有它自己的一组重构技术，主要与沿着类继承层次结构移动功能、创建新的类和接口、用委托替换继承相关，反之亦然。例如:拉起字段、拉起方法、拉起构造函数体、下推字段、下推方法、提取子类、提取超类、提取接口、折叠层次、表单模板方法、用委托代替继承、用继承代替委托等。

基于范围和复杂性，有两种类型的重构工作。抽象分支是一些团队用来进行大规模重构的技术。基本思想是构建一个抽象层，它封装了系统中要重构的部分和最终要替换它的部分。例如:

封装字段——用 getter 和 setter 方法强制代码访问字段，

泛化类型——创建更通用的类型以允许更多的代码共享，用状态替换类型检查代码，用多态替换条件等。

**组合方法重构**

很多重构都致力于正确组合方法。大多数情况下，过长的方法是万恶之源。这些方法中代码的变幻莫测隐藏了执行逻辑，使得方法非常难以理解，甚至更难更改。这一组中的代码重构技术简化了方法，消除了代码重复。示例包括:提取方法、内联方法、提取变量、内联临时、用查询替换临时、拆分临时变量、删除参数赋值等。

**在对象之间移动功能重构**

这些代码重构技术展示了如何在类之间安全地移动功能，创建新的类，以及对公共访问隐藏实现细节。例如:移动方法、移动字段、提取类、内联类、隐藏委托、移除中间人、引入外来方法、引入本地扩展等。

**简化条件表达式重构**

随着时间的推移，条件往往在逻辑上变得越来越复杂，而且还有更多技术可以解决这个问题。例如:合并条件表达式、合并重复的条件片段、分解条件、用多态性替换条件、移除控制标志、用 guard 子句替换嵌套的条件等。

**简化方法调用重构**

这些技术让方法调用更简单，更容易理解。这简化了类之间的交互接口。例如:添加参数、移除参数、重命名方法、将查询与修饰符分离、参数化方法、引入参数对象、保留整个对象、移除设置方法、用显式方法替换参数、用方法调用替换参数等。

将代码分解成更多的逻辑片段重构

组件化将代码分解成可重用的语义单元，这些语义单元呈现出清晰、定义明确、易于使用的界面。例如:extract class 将现有类的部分代码移动到一个新类 extract method 中，将一个较大方法的一部分变成一个新方法。通过将代码分解成更小的片段，更容易理解。这也适用于函数。

**用户界面重构**

对用户界面的简单更改保留了它的语义，例如:对齐输入字段、应用通用按钮大小、应用字体、指示格式、以活动语音重新措辞以及增加颜色对比度等。

下面是一些代码重构技术的例子；其中一些可能只适用于某些语言或语言类型。更长的列表可以在马丁·福勒的《重构》一书中找到，我们在上面讨论过。

如果您对软件开发的最佳实践感兴趣，我强烈推荐您[订阅我们的每月简讯](http://eepurl.com/cC96MY)以接收最新的软件开发书籍、技巧和即将到来的活动。

## 如果你喜欢这篇关于代码重构技术的文章，你可能会喜欢…

[2018 年要读的软件开发书籍](https://dev.to/apium_hub/20-essential-software-development-books-to-read)

[为什么是科特林语？谷歌为什么选择它？](https://dev.to/apium_hub/why-kotlin-language-android-why-did-google-choose-kotlin--639)

[iOS 与浪子持续整合&詹金斯](https://dev.to/apium_hub/ios-continuous-integration-with-fastlane--jenkins-19n)

[iOS 中的 MVP 模式](https://dev.to/apium_hub/mvp-pattern-in-ios-98f)

[今年要读的软件架构书籍](https://dev.to/apium_hub/top-19-software-architecture-books-blf)

[Scala 类型界限](https://dev.to/apium_hub/scala-generics-i--scala-type-bounds-38)

[在 Scala 的一般类型上的 F-bound](https://apiumhub.com/tech-blog-barcelona/f-bound-scala-generics/)

[安卓模拟器中的查尔斯代理](https://apiumhub.com/tech-blog-barcelona/charles-proxy-android-emulator/)

[顶级软件开发博客](https://apiumhub.com/tech-blog-barcelona/top-software-development-blogs-2017/)

[顶级软件测试技术&使用的工具](https://apiumhub.com/tech-blog-barcelona/top-software-testing-techniques/)

[将提高你工作效率的 Tmux 指南](https://apiumhub.com/tech-blog-barcelona/tmux-cheat-sheet-tips-tricks/)

[功能债务 vs 技术债务](https://apiumhub.com/tech-blog-barcelona/technical-debt/)

[BDD: UI 测试](https://apiumhub.com/tech-blog-barcelona/user-interface-testing/)

[微服务 vs 整体架构](https://apiumhub.com/tech-blog-barcelona/microservices-vs-monolithic-architecture/)

[面向对象设计中的 SRP](https://apiumhub.com/tech-blog-barcelona/single-responsibility-principle/)

[几乎无限的可扩展性](https://apiumhub.com/tech-blog-barcelona/almost-infinite-scalability/)

代码重构技术的帖子最早出现在 T2 的 Apiumhub 上。