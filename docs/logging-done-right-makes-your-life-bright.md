# 正确记录，让你的生活变得明亮！

> 原文：<https://dev.to/grhegde09/logging-done-right-makes-your-life-bright>

我从事嵌入式设备的应用程序开发已经有几年了。我们工作的所有嵌入式平台都没有一个好的开发环境。有些平台甚至没有 [GDB](https://en.wikipedia.org/wiki/GNU_Debugger) 。所以我们必须完全依靠日志来分析问题。

当调试代码的唯一方法是通过日志时，并不是每个人都明智地记录日志。相反，无论信息的重要性或日志的频率如何，都会记录大量信息。当你在一个有许多开发人员的团队中工作时，日志很容易膨胀。在最近的一个项目中，我们有如此多的日志，以至于每分钟大约 2 兆字节。梳理成千上万行日志来找到您感兴趣的日志并分析问题是一场噩梦。

以下是我们改善现状的一些方法。

## 更好的记录者

### 多个日志级别(咄！):

对于任何日志记录器来说，最重要的(也是最常见的)特性之一就是能够根据日志的重要性来区分日志。我们为日志定义了以下四个级别。

1.  错误-针对致命错误情况。
2.  警告-对于非致命错误。
3.  Info -获取有助于轻松发现问题的重要信息。
4.  调试-其他一切。包括函数入口，出口日志到一个开发者的心酸故事！

我们添加了通过 logger 模块中的配置文件为应用程序的每次运行选择日志记录级别的功能。这对我们帮助很大。例如，我们可以在调试级别关闭所有日志，这样我们需要查看的日志就会少得多。

### 模块级日志记录:

尽管多个日志级别非常有用，但还不够。我们发现，基于模块的日志记录能力也非常重要。所以我们为每个模块创建了一个标识符(比如我们创建的每个库)。我们添加了通过配置文件为每个模块选择日志级别的功能。这是一个恩惠！现在，我们可以定制我们想要的日志。例如，如果我正在调试依赖于模块 B 的模块 A，我可以配置 logger 模块来启用模块 A 中的调试级别日志、模块 B 中的信息级别日志和所有其他模块的错误级别日志。

### 记录所有信息的日志:

我们日志中的每一行都有很多信息。它包括日志的写入时间、日志级别、生成日志的线程名、实际日志、生成日志的函数的完全限定名等。在每个日志中包含所有这些字段对我们调试问题帮助很大。

### 运行时控制:

在我们拥有了上述特性之后，剩下的唯一要做的就是添加在运行时进行定制的功能。我们在系统中的典型行为是，一旦应用程序处于某个有问题的状态，它就会一直处于那个状态。因此，如果能够在运行时定制模块的日志级别，将会非常有帮助。因此，我们使用一个文件监视器来监视配置文件的变化，只要检测到变化，就在内存中重新加载日志模块配置。瞧吧！我们有了终极伐木工！

## 更好地了解日志记录

有一个好的记录者只是等式的一部分。在整个代码中明智地放置包含适当信息的日志也非常重要。在代码的重要部分没有日志和在代码中有不必要的日志一样糟糕。下面是一些我们用来改进日志记录的经验法则。

*   如果一个模块生成了太多的日志，让日志定期而不是基于事件。例如，如果视频编码器记录每一帧的所有信息，它将在一秒钟内生成太多日志。取而代之的是，所有的信息都可以以例如 1 秒的间隔累积和记录。
*   避免日志中的冗余。即不要将函数名、线程 id 记录为日志消息的一部分，因为它已经被记录器添加到日志中。
*   严格遵循日志记录级别。
*   将所有输入参数记录在 API 的信息级别中。
*   在 API 的信息级别中有函数入口、出口日志(作为其他规则的例外。)
*   所有实用程序的默认日志级别应该是 Error。这种改变可以在实用程序已经过彻底测试并且不存在任何错误之后进行。
*   为代码中的每个`else`添加一个日志。

## 多余的东西不会有坏处

### 崇高文本的 LogAnalyzer 插件

我职业生涯的前三年是 windows 用户。我喜欢使用带有[分析插件](https://sourceforge.net/projects/analyseplugin/)和[日志专家](http://www.log-expert.de/)的记事本++等应用程序。我曾经很喜欢这些工具，因为它们帮助我快速分析日志。从那以后，我转到了 macOs，并努力获得一个分析日志的好工具。Notepad++ on wine 还可以，但是按键绑定很痛苦。TextWrangler 是一个很好的工具。但我希望它能做得更多。

所以我决定在 Sublime text 上写一个小插件来帮助我分析日志。我花了一个周末的时间写了一些脏代码来获得我想要的基本功能，但它几乎一直停留在那个状态。请在这里随意使用/改进插件[。](https://gitlab.com/grhegde09/LogAnalyzer)

[![Log well. Live well!](img/98058edd60d6d7cefb1f92cbe60cfeeb.png "Log well. Live well!")T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--woEpKFiE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://cdn.meme.am/instances/500x/76282612/spock-log-well-live-well.jpg)