# Oracle 中的索引指南

> 原文:[https://dev.to/databasestar/a-guide-to-indexes-in-oracle](https://dev.to/databasestar/a-guide-to-indexes-in-oracle)

在本文中，我们将探讨数据库中的索引这一主题。

## 什么是指数？

你曾经尝试过使用百科全书吗？那种又大又厚的书，有很多关于一系列主题的信息？

SQL 索引的概念类似于使用百科全书。

假设您想要查找特定主题的信息:拉布拉多犬。你可以用几种方法来做到这一点:

*   从第一页开始，浏览每一页，直到找到拉布拉多犬
*   翻到随机的一页，看看你是否能找到拉布拉多犬，重复直到你找到它。

这将非常耗时，而且效率低下。

幸运的是，百科全书使用一些不同的方法来使查找信息变得更容易。这些主题通常是按字母顺序排列的。

通常在书的后面还有一个索引，包括了书中所有的主题。如果我们在索引中查找拉布拉多犬，我们可以看到:

*拉布拉多犬…第 100、125、217 页*

这告诉我们，这三页上都提到了拉布拉多犬。我们可以简单地进入这些页面，找到更多关于拉布拉多犬的信息。

这与数据库中索引的工作方式类似。它们会占用更多的空间，但是它们可以帮助你找到你想要的东西。当你知道你正在寻找的记录时，他们也能工作得最好。

## B 树索引

在大多数数据库中有许多类型的索引，但最常见的是所谓的 b 树索引。

b 树代表“平衡树”，之所以这么叫是因为它以相同的步数访问索引的元素。我们很快会解释这意味着什么。

让我们用前面的例子来解释这是如何工作的。我们想在 125 页找到提到拉布拉多犬的地方。

b 树索引的工作方式如下:

1.  确定我们要寻找的记录(或者在本例中是页面)。在这种情况下，它是 125(页码)。
2.  查看索引的第一级，查找包含数字 125 的值的范围。这些范围可以分成 100 组:1-100，101-200，201-300，301-400。
3.  移动到上一步中确定的第二级索引。在这种情况下，它的范围是 101-200，因为 125 位于该范围内。
4.  找出第二层中包含 125 的值的范围。这可以是 20 人一组:101-120 人、121-140 人、141-160 人、161-180 人、181-200 人。在这种情况下，范围是 121-140。
5.  找到 ID 为 125 的记录并返回该记录。

“在一个范围内查找”和“向下移动一级”是一个重复的步骤序列。在大多数情况下，这种情况会发生五次。

结果是找到了正确的记录，比扫描每条记录要快得多。

那么如何创建 B 树索引呢？这取决于数据库系统，但是 Oracle 的语法是这样的:

```
CREATE INDEX index_name
ON table_name (columns); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

您需要指定几件事情:

*   index_name:要为索引指定的名称。
*   table_name:正在创建索引的表的名称。
*   columns:要包含在索引中的一列或多列。

如果我们有一个表来表示上面的例子，我们的 SQL 语句应该是这样的:

```
CREATE INDEX idx_topic_pageno
ON topic(page_no); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

在本例中，新索引名为 idx_topic_pageno，它是在主题表上名为 page_no 的列上创建的。

## 位图索引

数据库系统中另一种常见的索引类型是位图索引。

这在系统中表示为二维表，通常称为值的“图”。

对于每一行，都有一个 ROWID，这是该行的唯一标识符。对于每一列，特定列都有一个单独的值。

在行和列的交叉处是一位。该位指示 ROWID 是否具有列中提到的值。

例如，我们有一个存储衣服的表，每一行都有一个尺寸。位图索引可能如下所示:

| ROWID | S | M | L |
| --- | --- | --- | --- |
| AA01 | one |  |  |
| AA02 |  | one |  |
| AA03 | one |  |  |
| AA04 |  |  | one |

为什么这很重要？为什么有用？

这是一种更高效地访问数据的不同方式。如果值的范围很小(比如上面显示的 S/M/L)，那么使用这种索引通常会更好。

创建索引时，不需要指定每个值如何映射到每一行。这都是由数据库系统自动完成的。

创建一个位图索引(无论如何在 Oracle 中)，语法是:

```
CREATE BITMAP INDEX index_name
ON table_name (columns); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

这种位图索引和 b 树索引的语法之间的唯一区别是增加了单词 bitmap。这是 Oracle 的语法——其他数据库可能略有不同。

还可以指定 index_name(索引的名称)、table_name(正在创建索引的表)和 columns(正在创建索引的列)。

如果我们使用上面的例子编写一个语句来创建这个索引，它可能看起来像这样:

```
CREATE BITMAP INDEX idx_product_size
ON product (product_size); 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

这将在 product 表的 product_size 列上创建一个名为 idx_product_size 的索引。

## 其他指数类型有哪些？

在 Oracle 和其他数据库系统中有许多不同类型的索引。我在这里简单解释一下其中的一些。

**基于函数的索引**:一种使用函数或表达式创建的索引，用于提高包含函数的查询的效率。

**反向键索引**:在 b 树索引中存储和排序数据的不同方式。

**位图连接索引**:两个表连接的位图索引。

在我的 Oracle 索引指南中，我介绍了一些更具体的 Oracle 索引，以及它们在解释计划语句中是如何显示的。

## 什么时候应该创建索引？

通常，开发人员在改进运行缓慢的查询时要做的第一件事就是创建索引。我过去也为此感到内疚。

然而，一旦你理解了索引是如何工作的，你就会知道什么时候创建一个索引是合适的，以及它能如何帮助你。理解数据和表的结构也很重要。

因此，在创建索引时，您应该考虑一些事情:

*   在 WHERE 子句或联接中的列上创建索引是一个好主意。
*   如果一个列有很大比例的唯一记录，b 树索引通常更合适。
*   如果列中唯一记录的百分比很低，位图索引通常更好。
*   考虑在外键列上创建索引(无论如何，外键列经常在连接中使用)，因为它们不是自动创建的(无论如何，在 Oracle 中)。
*   如果 WHERE 子句中的列在条件中使用函数或表达式，请考虑创建基于函数的索引。

创建索引有优点也有缺点。我们已经在这篇文章中提到了这些优势。缺点是:

*   索引会占用数据库更多的空间。这可能很重要，取决于你的桌子，如果你受到空间的限制，这是要考虑的事情。
*   索引会降低插入、更新和删除查询的速度，因为无论何时运行这些语句，都需要更新索引和表。

因此，总的来说，索引很有帮助，是提高查询性能的好方法。有几种不同的类型，适用于不同的情况，并且它们很容易创建。理解每种方法的优缺点以及您的数据结构，有助于决定何时以及是否创建索引。