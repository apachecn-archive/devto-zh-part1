# 为什么我选择创建自己的 PHP7 商店软件(我对此很满意)

> 原文：<https://dev.to/phpandcigars/why-i-choosed-to-create-my-own-php7-shop-software-and-i-am-happy-with-it>

## 免责声明

请原谅我糟糕的英语。因为一个非常糟糕的老师，我不得不放弃高中的英语课。

## 关于我的项目

两年前，我开始了一份新工作。我的雇主希望我创建一个新的网上商店，并给我完全的自由。由于它是公司的一个附带项目，主要用于探索新技术、用户体验和搜索引擎优化方法，并且只能长期盈利，我有机会创建一个不错的软件，并在此过程中学习了很多。我不能说我选择的道路是正确的，但它对我来说似乎是正确的。

## 要求

创建一个快速、可伸缩、可扩展的多商店软件。

## 首先决定:语言

是的，我很好奇去尝试一些新的东西，比如 Ruby on Rails 或者 Django，但是最终这个项目对我来说太大了，不能失败。我见过项目失败，因为整个团队在没有语言经验的情况下转向 rails。所以我坚持使用 PHP，这是我在 2001 年第一次尝试。我也很好奇尝试 PHP7 的新特性。

## 第二个决定:铺-软件，PHP-框架还是从头(差不多)开始？

目标是创建一个快速加载，很好地定制网上商店。我首先想到的是尝试 Magento。很多竞争对手都使用 Magento，那么我如何才能用同样的软件创造优势呢？最后，缓慢的速度是我可以获得积分的一个弱点。我试了其他一些，但也不满意。今天，我可能会决定尝试商店用品。但是当时的版本并不符合我的需求。

此外，我过去在框架方面的经验并不太好。可能我接触 Symfony 和 CakePHP 太早了。我想，我花了太多的时间来查找东西，当功能丢失时，我经常感到失望。

所以，我决定做一些愚蠢的事情，根据一次会议的谈话创建一个新的商店。我以前写过几个 MVC 框架。我上次写框架是为了我的学士论文。所以我决定去掉基本的 object、list 和 datatype 类，并在我的项目中使用它们。

上面提到的会议讨论是关于创建一个推式架构，而不是拉式架构，在拉式架构中，几乎所有东西都是静态的、缓存的内容。

## 在 App/Core 中拆分一切

因为我想重用代码，并偶尔重写代码来为特定商店定制代码，所以我决定通过 App 名称空间处理所有内容。所以我有很多空类，它们只是扩展了核心类。

一个有用的工具是“Kaderschule”(干部学校)。因为我和一位社会主义国家元首同姓，所以我觉得用这个词来双关并给阶级创造者起这样的名字很有趣。该脚本不仅为一个项目创建类，还可以为所有项目创建类，我只用一个命令就可以完成。

## 模板引擎与渲染器

因为我想做这些天人们使用的所有花哨的东西，所以我认为尝试一个模板引擎是个好主意。不幸的是，覆盖部分的可能性似乎不是很优雅。我很快会详细解释这一点。

所以我做了些调查。我甚至去了大学图书馆。所有以网络开发为主题的书(比如 7、8 本书)都提出了同样的建议:使用模板引擎。

最后，我想到了鲍伯·马丁叔叔用干净代码写的清单。他使用了几个渲染器类来替换输出。这也意味着我不得不写更多的代码，我对我浏览渲染器的方式以及如何覆盖和扩展渲染器类感到满意。

考虑以下清单:

```
public function Render() {
    return
        $this->RenderProductName()
        . $this->RenderProductImage()
        . $this->RenderPrice()
        . $this->RenderAddToShoppingCartButton()
        ...
    ;
} 
```

记住，我想为几个商店创建一个代码库。上述函数可以在核心类的 ProductRenderer 中。想象一下，对于 n 家商店中的一家，我想要呈现价格和添加到购物车按钮之间的用户评论(也称为星号)的简短摘要。

我可以简单地将代码改为

```
...
        . $this->RenderPrice()
        . $this->RenderRatingssummary() // New function was inserted here
        . $this->RenderAddToShoppingCartButton()
...

    protected function RenderRatingssummary() {
        return '';
    } 
```

然后，我可以在扩展核心类的 App 命名空间中的相应类中实现该函数。使用模板引擎，我将不得不复制/粘贴这一部分。即使在商店软件中，你不应该接触核心类，我也必须复制/粘贴代码。这是我真正需要避免的事情。

所以我对这个解决方案非常满意。也许将来我仍然会使用模板引擎来创建一些静态的特定领域的内容，但是现在这种情况还没有出现。我真羡慕 HAML 的可读性。

## 触发页面预渲染。

如上所述，我想创建一个超级快速的网站。因此，每个产品、品牌、分类页面等都被预先渲染并缓存在 memcache 存储中。memcache-entries 包含由用户特定内容(如购物车计数器或登录图标)替换的 HTML。替换之后，HTML 就可以被回显了。

每次产品发生变化，相应的页面都必须重新呈现。这是通过创建触发器来实现的，触发器只是将对象 id 和对象类型插入到渲染 fifo 中。

守护进程定期检查渲染 fifo 中是否有数据，然后开始渲染页面并将渲染器的输出存储在缓存中。这实际上并没有看起来那么复杂，但仍然会产生一些心理摩擦，所以我请了一位老同学来帮助我。最后，清理一些代码帮助我创造了创建一个快速网上商店的主要技巧。

## 结论

我不是说，停止使用那个框架或那个商店软件。我只能说，对我和我的需求来说，这是赖特的决定。如果你也想试试:我不是天才。我确信如果你有预算(我认为这是大多数公司最大的问题)来写一个自己的商店软件，你也可以做到。

我希望这篇文章有助于鼓励人们不要害怕创建类似的东西，并让人们明白软件不是魔术。这只是一小时又一小时的编码。