# 更快地编写 DSL 和代码

> 原文:[https://dev.to/barryosull/write-dsls-and-code-faster-20me](https://dev.to/barryosull/write-dsls-and-code-faster-20me)

(原载于[我的博客](http://barryosull.com/blog/write-dsls-and-code-faster)。)

# 什么是 DSL

DSL 代表领域特定语言，这意味着它是一种被设计用来解决领域中特定问题的语言。如果您想为一个特定的问题编写一个通用的解决方案，而不需要所有的样板代码，DSL 是很棒的。

一个好的 DSL 易于编写和理解。一旦有人理解了领域语言，他们就可以阅读 DSL，理解问题所在，即使他们不是程序员。DSL 允许我们自动化许多事情，包括开发的各个方面，极大地提高了我们的速度，降低了代码和错误率。

# 这是我之前做的一个

在工作中，我对我们总是花这么长时间来编写将 HTTP 请求解码成域对象的请求处理程序感到恼火。所以在我的业余时间，我设计了一个 DSL 来自动化这个过程，然后把它添加到我们的代码库中。这是其中一个 DSL 文件的完整示例。

## 检查请求 DSL

```
User.ScheduleAppointment has { 
  a UserId userId 
  an Appointmentatetime appointmentDatetime
  a Location location from {
    a LocationName locationName from location
    a Latitude latitude
    a Longitude longitude
  }
} 
```

这个简单的 DSL 定义了一个进入服务器的请求，然后被转换成一个命令，然后由系统处理。DSL 定义了命令、命令的输入以及用于创建这些输入的请求参数。我们使用基于 CQRS 的系统，带有值对象和命令，所以我们的语言非常简单，定义明确，结构良好。(如果你不知道 valueoject 是什么，[你可以在这里找到](https://en.wikipedia.org/wiki/Value_object))

因此，在上面的 DSL 中，我们有一个命令“User。ScheduleAppointment”(猜猜这是做什么的)，它有很多输入。第一个输入称为“UserId”，它是一个“userId”类型的 valueobject。传入 ValueObject 的请求参数隐含在输入的名称中，即“userId”。您可以通过使用“from”关键字来使用不同的请求参数，这可以在第 6 行中看到。这使我们能够处理客户端发送的请求中包含错误的或错误命名的字段的情况(例如，遗留客户端)。

实际上，有时 ValueObject 的输入来自其他 value object，而不仅仅是请求参数(字符串)。这就是为什么我们用圆括号将标签式输入层括起来。这允许我们以简单、自动化的方式构建非常复杂的分层对象。由此，我们可以轻松地构建创建命令所需的输入树。

就这样，我们定义了我们的语言。

# 这种 DSL 有什么优点？

你已经可以看到这个 DSL 的主要优势，它允许我们自动化一个复杂的，容易出错的过程。然而，事实证明，我们可以使用这个 DSL 来解决各种其他问题，进一步突出它们是多么有用。这里有几个例子。

## 1。生成请求

制作一个请求对象客户端不再是一件痛苦的事情。我们可以使用相同的 DSL 来定义应该发送的请求的形式，并且您可以在发送请求之前对其进行验证。不仅如此，您还可以自动生成请求本身。我们创建了一个请求工厂，它接收一个表单，并尝试通过键提取请求参数。然后我们可以手动设置任何剩余的参数。非常方便。

## 2。发送和接收请求

向服务器发送请求很容易，但实现起来很累，尤其是在 URL 没有统一命名和结构的情况下。你最终会写出很多样板代码，修改起来很痛苦。好吧，你可以自动化这个。我们创建了一个单一的命令端点，它接收上面的请求，然后解码命令并运行它。现在我们只有一个端点，所以我们的代码大大减少了，包括客户端和服务器端。

## 3。记录请求

我们可以使用上面的 DSL 来创建一个请求模式。该模式可以在文档中使用，或者您可以使端点自文档化。如果有人用“OPTIONS”方法发送一个请求，您就以 JSON 的形式返回模式，让人们更容易使用和理解您的 API。

## 4。发展速度

一旦你理解了这种语言，改变或者写一个新的请求就变得快速而轻松。使用这个 DSL，我能够在不到 30 分钟的时间内编写并验证整个请求集合(总共 20 个)。如果我手边没有 DSL 的话，这至少要花费我一天的时间。

## 5。模块化的

这个 DSL 不只是针对我们当前的应用程序，它可以用在任何应用程序中，只要它使用命令和 valueobjects(我们所有的应用程序都会这样做，我们是 DDD/CQRS 迷)。所以现在有了另一个工具，可以快速加速我们所有应用程序的开发。

# DSL 可以在任何地方使用

你在上面看到的是一个简单的 DSL，它极大地提高了我们的开发速度。它自动化了一个痛苦的、容易出错的过程，还提供了许多其他好处。想想看，那只是一个 DSL。想象一下，你可以用多个 1 来做什么，一起工作！你可以编写 DSL 来自动化几乎任何可以用语言定义的过程。如果你仔细想想，这就是每一个过程，因为我们通过语言来定义和交流过程。天空是无限的。

最后，我要说的是。开始写 DSL。您将做开发人员最擅长的事情，自动化流程。学会如何去做，你就不会回头，事实上，你会想如果没有它你是如何工作的。

如果您想用 Javascript 解析上面的 DSL，请继续关注我的下一篇文章。