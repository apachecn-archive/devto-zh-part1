# 克里斯托弗·切多谈 React 背后的核心理念

> 原文：<https://dev.to/ben/christopher-chedeau-on-the-core-philosophies-that-underlie-react>

在过去的一年里，脸书的 [React](https://facebook.github.io/react/) 项目大受欢迎，其主要的 Github 库总共获得了 60，000 颗星。尽管 React 最初是在 2013 年开源的，但直到去年，随着 React Native 的发布，该项目的受欢迎程度才开始上升。

凭借其对声明式用户界面构建的重视以及使用 [React Native](https://facebook.github.io/react-native/) 带来的更好的移动开发体验，project 在 JavaScript 社区点燃了一把火，并通过直接挑战已建立的编码实践和惯例来影响编码实践。这个项目的核心人物是脸书的前端工程师克里斯多佛·切多。实际的开发人员对 React 的未来有一些迫切的问题。

## 本土反应如何影响本土反应，反之亦然？

### 渲染目标

许多人感到困惑的一点是，React Native 不是 React for Native 的重新实现。React Native 实际上在后台使用完全相同的 React 代码。React Native 提供了一组不同的基本组件。它没有将`<div>`和`<span>`作为低级原语，而是有了`<View>`和`<Text>`，它们是由 iOS 和 Android 中各自的计数器部件烘焙而成的。

React Native 并不是我们第一次尝试用 React 来定位 DOM 以外的东西。我们有一个名为[react start](https://github.com/reactjs/react-art)的图表库，基于浏览器功能来定位 canvas、svg 或 vml。虽然这样做肯定是可能的，但这需要一些黑客攻击。一旦我们能够证明 React Native 可以工作，我们就开始在 React 内部和渲染器之间进行适当的分离。我们现在有 React、React-dom 和 React Native。

真正令人兴奋的是，这有助于外部人员为 React 编写其他呈现器。有一些活跃的项目针对 3D 和虚拟现实、终端甚至是 led 等硬件。

### 表演

当我们开始这个项目时，最大的担忧之一就是性能:React 和 JavaScript 能在性能方面与 native 竞争吗？我们发现，使用 React Native 编写性能卓越的应用程序确实是可能的。

最重要的一点是，移动和网络的区别在于性能特征。在 web 上，你希望尽可能减少渲染和更新的总时间，这正是 React 的优势所在。在手机上，你需要在固定的时间内回复。

每个人都在谈论 60fps 是有原因的。通常，响应用户触摸交互或动画的时间限制为每帧 16 毫秒。如果你没有遵守这个期限，用户可能会注意到。

我们已经在许多方面着手解决这个问题。首先，在架构上，我们使用一个管道架构，其中 ui 线程与 js 线程对话，js 线程然后与布局线程对话，布局线程接着与“React Native core”线程对话，后者最终将操作发送到主线程并重复。这种方法使我们能够使用手机拥有的多核。

JavaScript 仍然是单线程的，所以我们正在寻找更好地调度操作的方法。我们使用 InteractionManager 来避免在交互或动画运行时进行计算开销很大的工作，[requesteidlecallback](https://w3c.github.io/requestidlecallback/)在下一帧开始之前在帧的末尾调度工作，以及一个既有表现力又可以在 js 线程之外运行的动画 API 将 React 渲染工作拆分到多个帧上。

我们投资的另一个大领域是模具。不幸的是，没有什么灵丹妙药可以让你的应用程序运行得更快，大多数时候，让应用程序运行得更快的最好方法是分析它，找到瓶颈，积极地优化它，然后重复。一旦你做到了这一点，你需要有一个持续的性能测试来发现和对抗即将到来的倒退。为了实现这些，你还需要改变工程文化来关心这些。这些都不是 React 本地特有的。我们也将这些知识用于网络方面。

## 平台和约定的蔓延导致了许多开发痛苦，而 React 的抽象可以弥补这些痛苦。你认为这在可预见的未来会如何发展？

### 问题

当我开始从事 React Native 的工作时，我认为 iOS、Android 和 web 之间有着根本的区别。然而，我为 React Native 重新实现的东西越多，我就越意识到，如果忽略命名和语言，它们仍然以非常相似的方式执行相同的功能，但彼此之间不兼容。

如果你在看流行的应用程序，你会发现这一点:开发者想为三个平台做同样的事情，暴露出微小的设计差异。不幸的是，为了让开发者跨三个平台构建移动平台，你需要三个不同的工程师，因为有三套不同的工具链、语言和 API。

### React 本机 take

我在两年前就意识到了上述问题，但并不确信它会很快得到解决。我认为 React Native 是一个雄心勃勃的项目，旨在解决一个本来就不应该存在的问题。有无数的项目试图解决跨平台的问题，但是没有一个项目带来任何基本的价值。因此，您可能会接触到一个新平台，但很快就会发现它与您以前使用的平台非常相似，不支持多平台，并且在尝试与两个现有平台互操作时会引入各种问题。

React Native 最初被称为“React iOS ”,但它并不是平台无关的。我希望项目成功，因为它更好，而不是因为跨平台的特性，管理层强迫开发人员使用它。这是一个非常困难的挑战，因为 UIKit 和 Xcode 设置了很高的标准。

第一大区别是 React，这是一种完全不同的构建 ui 的方式。有趣的是，我们现在正在使用 React 和 obj-c 框架 [ComponentKit](http://componentkit.org/) 构建我们的原生 iOS 应用。

二是对开发者体验本身的强调。我们通过使用解释 JavaScript 编程语言和新构建的打包工具来缩短编辑-重新加载周期，从而提供了更好的开发人员体验。我们还提供了非常需要的工具，如红色和黄色框，以更好的方式呈现错误，元素检查器，以快速找到生成 UI 部分的代码片段，Chrome 控制台，调试器和网络面板。

该项目的激动人心之处在于，React Native 的好处超出了我之前强调的范围，因为开源社区将它融入了自己的环境。我们的开源方法非常重要，因为我们帮助彼此变得更好，最重要的是在当今复杂的技术环境中创建新的标准。

我们的目标是为其他公司提供一组强大的 API，作为 React 原生视图嵌入到现有应用程序中。如果你最终意识到你想回到 native，你可以通过用纯 native 写你的新观点来逐步走出去。

也就是说，有许多公司面临着不同的战略和挑战。虽然未来的具体情况还不清楚，但我希望在保持开放透明的环境的同时关注开发者的体验将继续成为优先考虑的事情。

## React 引发了一场关于“关注点分离”的辩论，看起来你个人为“JavaScript 中的 CSS”点燃了一把火。社区的反应如何，这些反应如何改变了核心团队思考这些事情的方式？

我认为“关注点分离”主要是一种解释和合理化模板/JavaScript/CSS 架构的方法。如果你这样写你的代码，那么谈论“关注点分离”是有意义的。但这不是构建应用程序的唯一方式。如果你看看 iOS 环境，它没有样式表或模板，但是写应用程序也很好。

React 和 React Native 的做法不同的原因最好通过查看历史来解释。脸书前端历史上一直是用 PHP 编写的——你可以用 echo 和字符串连接来构建你的 HTML。但是，这种方法存在安全隐患，因为如果由于某种原因忘记了对用户提供的数据进行转义，就有可能注入将被执行的任意代码。

一个聪明的工程师通过将 HTML 提升为 PHP 语法的一部分解决了这个问题。写回显`<div>{$text}</div>`有效，自动转义`$text`值。它不仅解决了与字符串连接相关的安全问题，而且还开放了构建定制组件的能力，使您能够混合 HTML 和代码来构建整个网站。然后，我们将这个想法移植到 JavaScript 上，它在那里同样工作得很好。

对于 JavaScript 中的样式，我忽略了实现 CSS 解析器和规则评估引擎(我已经重建了 CSS 的布局部分)。我确信在某个时候我需要做这件事，但是我尽可能的推迟了。

事实证明，这是一个很好的决定。我们不仅不需要 CSS，而且它还解决了我们在脸书遇到的大量 CSS 问题。我在 NationJS 上发表演讲，试图解决与 JavaScript 风格相关的争议，并在几个月后宣布 React Native 之前帮助提供一些教育背景。

一旦我们宣布了，我完全不知道 React Native 会引发如此广泛的运动，人们试图找到不同的方式来定义风格。我们的灵感来自发布后的讨论和 web 方面的内部原型开发 React Native 方法在 web 环境中有点太激进了。

## React 如何融入脸书更大的发展理念？

我们是脸书一个叫做产品基础设施的组织的一部分。我们的使命是创造方法来更快地前进，充满信心地迭代，并构建更可靠的软件。也就是说，我们今天使用的每一个软件都是由其他已经构建好的软件组成的。我们构建软件工具来构建软件，更重要的是，我们将开源软件整合到我们现有的软件中。所以，我们今天构建软件的方式已经发展了几十年，直到今天。

React 影响了许多其他框架，包括和不包括 UI，并推动我们走向更具功能性、声明性和异步的解决方案——远离命令式范例。

当我们有了一个潜在的解决方案，我们就利用需要支持的真实项目，用我们的解决方案来迭代它，因为我们知道，要以我们想要的速度和质量交付软件，我们必须重新思考我们如何构建的一切。

## 更多的发展中国家获得了互联网接入。在脸书，关于这些项目如何服务于不断发展的世界的需求，同时也为采用和从事该技术的开发人员提供稳定性的对话是什么样的？

脸书有一个非常有趣的特点，那就是产品是通用的。在翻译之外，世界各地的人们都可以使用相同的产品。

我们的工程师正在帮助解决让世界更加开放和互联的挑战，这创造了我作为一个法国人在巴黎能够获得的相同体验。

最大的区别不在于人们想如何使用脸书，而在于他们用来访问它的技术。在新兴国家，手机和网络连接的计算能力更具挑战性。作为脸书的一名工程师，这实际上是一个积极的局面，因为在充满挑战的条件下让应用程序正常工作需要创造性思维。如果你能让脸书在糟糕的网络条件下工作得更好，它通常也会在更强的网络条件下工作得更好；同时改善许多全球用户体验。

## 在 React 宇宙之外，还有什么脸书项目是人们应该更多谈论的吗？

与前端世界相关，我想到的两个是[反弹](https://github.com/facebook/rebound)和[流行](https://github.com/facebook/pop)，旨在更容易地编写与手势相关的动画。在 React Native 上编写动画 API 时，我受到了它们的极大启发。

如果你是静态分析，那么[黑客](https://github.com/facebook/hack-codegen)、[流量](https://github.com/facebook/flow)和[推断](https://github.com/facebook/infer)是需要关注的项目。人们从事这些工作的传统方式是用这些属性从头开始创造一种新的语言。能够用类型系统扩充现有的流行语言并大规模使用它是一个非常令人兴奋的前景。😀

OSQuery 是来自我们安全团队的一个非常不寻常的项目。它使您能够使用 SQL 查询正在运行的进程，打开网络连接等。与必须解析各种 Linux 命令的文本输出相比，这是一个很大的改进，也是改善开发人员体验的一个很好的例子。

我不断受到我们通过开源项目改进工具的持续和独特方法的启发，我真的希望看到社区中更多的合作继续下去。