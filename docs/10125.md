# 使用 Neo4J 和 VisJS 可视化质量属性

> 原文:[https://dev . to/alanmbarr/visualizing-quality-attributes-with-neo4j-and-visjs-jn3](https://dev.to/alanmbarr/visualizing-quality-attributes-with-neo4j-and-visjs-jn3)

当我出于个人需要开始一个新的软件项目时，我会专注于解决我的问题。任何软件项目都有质量属性，个人项目有一个简短的列表。在企业中工作任何为解决业务需求而构建的东西都比那些个人项目有更长的属性列表。一家初创企业最有可能拿出最不招人喜欢的产品，而且更有可能在未来建立技术债务并进行权衡。对于完全是绿地的产品，很难预测软件需要如何制作以防止未来的浪费。对于被重写的产品，路径已经很清楚了，集成质量属性要容易得多，因为现有的系统已经缺乏了。

我第一次听说质量属性是从我团队的架构师和借书人《持续架构》中。我看到其他人评论的一个主题是软件的架构和质量正在成为“整个团队”的努力。我找到了这张[海报](http://thetesteye.com/posters/TheTestEye_SoftwareQualityCharacteristics.pdf),并决定用它来定义我们将在重写中使用的度量标准。

这张海报定义了质量的等级，根据你的利益相关者和你的项目，你可以添加/删除不同的质量。我认为关于这张海报最困难的事情是，一个人可以创建的度量标准的数量可能是压倒性的。给出或只显示不同团队需要解决的领域可能比全部属性更容易。

这其中繁琐的部分是将内容转换成标准结构。我选择了 XML，并将其基于 [webdev 清单](http://webdevchecklist.com/)。虽然有点过时，但它的大部分是有帮助的，尽管比我想进入这个项目的实现细节层次要低一些。

该结构的形状如下

```
\<quality\>\<category name="Capability"\>\<rule name="Completeness"\>\<example\>All important functions wanted by end users are available.\</example\>\<metric\>Future features are story written and a estimated time frame is planned out.\</metric\>\</rule\>\</category\>\</quality\> 
```

从这种格式，我把它分解成不同的格式来形象化。首先作为 HTML 在所有类别或项目旁边有复选框。然后作为列表项进入 markdown。这份名单仍然令人望而生畏。这个列表主要是一个层次结构，它可以以树状格式或图形显示。一个联系网络。

最近，我和我的架构师同事讨论了如何将更多的数据显示成图形格式。虽然我们可能以某种方式了解我们工作的所有系统，但明确这些联系发生在哪里是有帮助的。

到目前为止，我的大部分编程经验都与 PHP 和 JavaScript 有关。从事功能简单的网络营销项目。现在，在一家金融公司工作，有大量数据在系统之间传输，正确性/安全性/健壮性就成了重中之重。我理解面向对象软件的概念，但很少需要对象。这个项目揭示了用默认属性创建对象的需求。

在研究如何显示图形数据时，我尝试了几个不同的选项，并决定用 [vis.js](http://visjs.org/) 来显示我的图形数据。我将数据保存在 XML 文档中，但是为了显示网络图，我需要将数据转换成关系。vis.js 需要的格式与其他软件相似，尽管术语不同。通常，您的节点用一个惟一的 id 和一个标签来描述数据集中的项目，以便有一个友好的名称和潜在的更多属性。边或链接定义了节点之间的关系。它们有一个属性描述了一个 from 和一个 to 关系。或者源和目标。这两个都是对象列表。

```
"nodes" : [{id:1,label:"first"},{id:2,label:"second"}], "edges" : [{from: 1, to: 2}] 
```

我已经编写了将 xml 转换成其他格式的代码。我开始创建一个直接的 JSON 版本，但是当我开始研究将这些数据导入到一个图形数据库(比如 Neo4J)时，我不想在导入过程中进行不必要的数据清理。JSON 版本确实有助于在 VisJS 中立即显示数据。文档的问题是必须有人负责维护它，有时变更发生得比文档过程还快。如果系统是自描述的，那么文档就更有价值，并且更新。我的最终目标是一个界面，不仅可以查看图形，还可以使用 VisJS 编辑功能将这些更新发送到图形数据库后端，以保存更改并与小组成员共享。

我比较了图形数据库的几种不同选择，选择了 Neo4J，因为它有很多文档和支持。在阅读时，我了解了他们的 cypher 查询以及他们如何描述数据之间的关系。比 JSON 更复杂一点。我从大多数文档中读到的一个要点是，上传数据最好通过 load csv 函数来完成。

我重用了相同的代码来生成我的 HTML/Markdown/JSON。我需要元素的 id 是唯一的，当我试图用 C#在一堆循环中创建新的 GUIDs 时，却产生了坏的/错误的数据。我的架构师同事建议我使用对象来提供默认属性。我不情愿地添加了这个，但它最终在这种情况下工作得很好。我创建了一个 GraphNode 对象和一个 GraphEdge 对象，当它们被创建时，它们会创建自己的私有 id，而其他的都是公共的。我添加的唯一额外属性是一个隐藏属性，所以不是所有的数据都会显示在 visjs 中。

一旦这些数据有了默认的对象属性，我将遍历每个节点和每条边，并把它们写到各自的 tab 单独的文件中。从那里我可以上传这个到 Neo4J。

我面临的一个挑战是，我希望导入所有这些数据并建立连接。在谷歌搜索的时候，我发现一个常见的模式是，当上传节点时，为所有节点创建一个默认标签，然后遍历所有你真正想要建立连接的不同属性，建立这些属性，然后删除原始链接。

Neo4J 有一些问题，例如上传文件被隔离到导入文件夹，除非更改设置。我把导入搞砸了好几次，找到了一个清理所有数据的建议密码。另一个问题是，目前不支持使用带凭证的浏览器获取，因为获取是如何与跨源头一起工作的，所以我禁用了本地数据库的 auth。

上传节点

```
USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM "file:///nodes.tsv" AS node FIELDTERMINATOR "\t" CREATE (n:group { id: node.id, label: node.label, content: node.content, hidden: node.hidden, group: node.group }) 
```

创建索引

```
CREATE INDEX ON :group(id) 
```

上传链接，并根据匹配标准标签组及其基于起始边和终止边的 id 创建连接。

```
USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM "file:///edges.tsv" AS edge FIELDTERMINATOR "\t" MATCH (a:group { id: edge.from }) CREATE (a)-[:CONNECTS { id: edge.id, hidden: edge.hidden }]-\>(b) 
```

基于其他属性创建新标签。这些是我的数据已经设置的属性。对所有标签重复上述步骤。

```
MATCH (n:group { group: 'root' }) SET n:root REMOVE n:group 
```

如果您需要删除边和节点，而不是索引，请使用此选项。

```
MATCH (a) WITH a LIMIT 10000 OPTIONAL MATCH (a)-[r]-() DELETE a,r RETURN COUNT(\*) 
```

一旦所有这些数据都在数据库中，我就可以开始查询了。Neo4J 文档中有一个常见的 javascript 示例，说明如何查询 Neo4J 事务提交端点来获取数据。用 visjs 显示数据的最后一步是将查询数据转换成 Neo4J 呈现的形式。基于他们提供的代码，端点给出了许多关于每个节点及其连接的额外数据，这些数据必须被过滤掉。还有一点额外的工作，包括我为每个节点上传的额外数据，以及引用我的图表中的正确关系。我想使用惟一的 GUID ids 而不是边的索引位置来引用节点。

一旦所有的数据都是正确的格式，我就把它加载到 vis 中。数据集格式并开始绘制图形。起初，这是一整套数据，仍然势不可挡。通过调整，我能够使用 visjs 理解的隐藏属性来限制数据量。我想为这个界面实现的最后一个特性是根据用户偏好隐藏和显示数据。我不想在这个时候只点击图中的节点来使用按钮。

Vis.js 有许多事件允许挂钩到点击、选择的节点和其他动作。有了这些，我就可以显示工具提示，其中包含我想为节点提供的额外信息。基于保持节点足够长的时间来显示或隐藏节点。以及双击任意位置时显示整个图形。最大的挑战是隐藏没有直接连接的节点。由于我的数据是一个层次结构，我可以找到所有的远程边，但如果这个图形连接到自己，我可能需要返工如何隐藏和显示逻辑工作。

我从这些不同的项目中学到了很多，并且让所有的东西都在一起工作。对于一个组织的实用性仍然是未知的。有些人发现数据看起来很有趣，但理想情况下，当创建可视化时，人们知道他们的受众以及如何以简单的方式传达复杂的想法。操作和保存图表的功能是可以实现的，但是作为一个终端用户，我不确定我有多需要这种功能。

我希望最终能够让系统以编程的方式描述它们自己和它们的连接，我可以轻松地更新和添加连接，而不必学习密码查询等等。如果我需要添加连接，我可以使用用户界面，否则数据会保存在数据库中。