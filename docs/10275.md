# 如何索引 AngularJS 中构建的单页应用程序

> 原文：<https://dev.to/roelofjanelsinga/how-to-index-a-single-page-application-built-in-angularjs-4dh1>

[![Magnifier](img/12a555fabcdead2db910099e4c038070.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--4jIexdE5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/1i1bgimvn2f83jytspdk.jpg)

# 如何索引 AngularJS 内置的单页应用

年龄(读:几岁)老问题...如何索引单页应用程序？我在之前一篇关于同构 JavaScript 的文章中简要介绍了这个主题。单页面应用程序对于用户体验来说非常棒，但是当然，它也有一些缺点，其中之一实际上是用户体验杀手。我将在这篇文章中描述我发现的使用 AngularJS 的两个缺点(我知道，我还没有完全转到 Angular 2，请冷静)以及解决这两个问题的解决方案。首先，我发现的缺点是:最初的页面加载需要很长时间，这导致用户离开你的网站并索引你的网站，或者任何社交媒体共享都是一种痛苦。我知道 Angular 2 已经解决了大部分问题，但我知道很多人仍然在使用 AngularJS，所以这就是为什么它仍然相关。

### 缺点

所以第一个缺点是:初始页面加载需要很长时间。这完全取决于应用程序的复杂性，但我工作的这个非常复杂，所以第一次抽奖需要 4 - 5 秒的时间。这意味着在应用程序真正启动并显示页面之前，用户会有一个大约 5 秒钟的空白屏幕。这很烦人，因为看起来网站好像坏了，所以人们在你的网站加载之前就离开了。一个超级简单的方法，至少让用户知道页面正在加载...就是显示一个加载符号。这个非常简单的机会可能会留住一些用户，否则他们会离开你的网站。这是第一步。第二步是延迟加载部分应用程序，或者确保脚本尽可能快地加载，例如通过 CDN 或静态域。这些变化使得在应用程序加载并为用户准备好之前，用户会有大约 3 秒钟的白屏(其中有一个加载程序)。这是一个巨大的进步，但还没有完全实现。

第二个缺点是单页面应用程序的动态特性。这意味着页面上的内容实际上都不是...在页面上。这些页面根本不存在。一切都在运行时加载。这导致了长时间的初始加载，但是在脚本加载后会有快速的界面。对于 SEO 来说也是一件非常不好的事情。搜索引擎和网络爬虫根本没有建立或准备好处理动态网站。他们似乎不明白，如今的网站非常动态，往往需要加载大量的 javascript 才能工作。如果我们以脸书和推特社交卡为例...你不会看到一个页面标题，或描述，或特色图片，甚至任何元标签。脸书开放图形爬虫根本不知道如何处理你的网络应用。

### 服务器端渲染！还是没有？

所以(容易，不那么容易)的解决方案是使用服务器端渲染或预渲染。这些术语是两个非常不同的东西。对于 AngularJS 这样的框架，控制器和指令与 DOM(HTML)紧密耦合，服务器端呈现几乎是不可能的。所以这种选择是不可能的。这就给我们留下了预渲染页面。这是什么意思？这意味着服务器在需要的时候提供页面的静态版本。这对脸书的 open graph crawler 来说是最有用的，因为它最终理解了它正在接收的数据。有一个标题，描述，标签和图像，它只是工作。一个不太奇怪的解决方案是让应用程序的加载屏幕看起来像它将要提供的视图。现在有一个众所周知的 prerender 服务可以通过 prerender.io 获得。我已经使用他们的服务一年多了，它工作得很好。它是开源的，可以从 Github 下载。

### 我想要更好的东西

然而，我想要别的东西，更像是一个混合的解决方案。现在，我们使用一个网站地图生成器来抓取所有页面，为谷歌制作一个巨大的网站地图。但对我来说，这似乎是两份可以合二为一的工作。我的意思是，如果你正在抓取网站上的每一页，为什么不同时预览所有这些页面呢？嗯，这是我做的。这种解决方案不仅在静态页面被请求时提供服务，而且它还是一个网站索引器，能够在尚未预呈现的情况下动态索引任何页面。我在 Node 中构建了这个吗？不，我没有。我实际上是用 Python 构建爬虫的。为什么？我以前在里面做过一个爬虫。这就像大多数爬虫只能索引静态页面一样。所以我用 PhantomJS 对其进行了增强，使其能够完全呈现动态页面，并将它们保存到一个文件中。然后，我将这个 Python 项目集成到我的 Laravel 项目中，将所有缓存的页面同步到一个 S3 驱动器，以满足 swift 请求。如果你有兴趣去看看，你可以从 Github 克隆它。如果你认为你可以做得更好(我认为你们大多数人都可以，因为我是一个巨大的 Python Noob)，创建拉请求来和我一起改进它。无论如何，这个解决方案能够抓取、索引和缓存整个网站的静态文件，我认为这很酷！