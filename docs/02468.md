# 如何用 webpack 构建 firebase 函数

> 原文：<https://dev.to/mizchi/how-to-build-firebase-function-by-webpack-e>

## 为什么

Firebase 的云函数有 node v6.11.x。对于 node.js 开发人员来说太旧了，无论如何我们需要自己的构建堆栈。比如我是巴别塔和流量用户。

此外，在像 SSR 这样的同构环境中，包应该是相同的版本。所以我认为将所有源代码捆绑到一个脚本中是最容易发布的解决方案。

## 如何构建

我的项目目录。

```
package.json
firebase.json
functions/
  _dist/ # generated by webpack
    index.js
    package.json
  index.js # entry point
  webpack.config.js 
```

Enter fullscreen mode Exit fullscreen mode

```
// functions/webpack.config.js
const pkg = require('../package')
const GenerateJsonPlugin = require('generate-json-webpack-plugin')

// Set externals that you don't want to build by webpack
const externals = [
  'firebase-admin',
  'firebase-functions'
]

const genPackage = () => ({
  name: 'functions',
  private: true,
  main: 'index.js',
  license: 'MIT',
  dependencies: externals.reduce(
    (acc, name) =>
      Object.assign({}, acc, {
        [name]:
          pkg.dependencies[name] ||
          pkg.devDependencies[name]
      }),
    {}
  )
})

module.exports = {
  entry: [__dirname + '/index.js'],
  output: {
    path: __dirname + '/_dist',
    filename: 'index.js',
    libraryTarget: 'commonjs'
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: 'babel-loader',
        exclude: /node_modules/
      }
    ]
  },
  externals: externals.reduce(
    (acc, name) => Object.assign({}, acc, { [name]: true }),
    {}
  ),
  plugins: [new GenerateJsonPlugin('package.json', genPackage())]
} 
```

Enter fullscreen mode Exit fullscreen mode

这个 webpack 版本`functions/_dist/*`。

编写你的 firebase.json

```
{
  "functions": {
    "source": "functions/_dist"
  },
  "hosting": {
    "rewrites": [
      {
        "source": "/api/hello",
        "function": "hello"
      }
    ]
  }
} 
```

Enter fullscreen mode Exit fullscreen mode

让我们构建和部署。

```
$ npm i -g firebase-tools webpack
$ webpack --config functions/webpack.config.js
$ cd functions/_dist/; npm install
$ firebase deploy only functions 
```

Enter fullscreen mode Exit fullscreen mode

您可以将此任务添加为 npm 脚本。