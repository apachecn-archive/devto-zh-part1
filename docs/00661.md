# 制造平行刮刀

> 原文:[https://dev.to/fcpauldiaz/building-a-parallel-scraper-54b2](https://dev.to/fcpauldiaz/building-a-parallel-scraper-54b2)

# [](#the-why)这个为什么

西蒙·西内克总是说，人们首先关心为什么，然后才是如何。这就是了。几个月前，一些在亚马逊上销售产品的朋友有了一个商业想法。他们说，在亚马逊卖家中存在一个问题，即亚马逊算法(称为 [A9](https://www.a9.com/) )可以在没有事先通知的情况下从一天变到另一天，这可能会大大降低销售额，因为配置的关键词可能会停止被索引。所以他们必须意识到这种情况何时发生。为了解决这个问题，目前的市场使用一些索引服务，告诉你一个产品的索引百分比，所以我的朋友们认为这仍然是乏味的，他们想建立一个自动化的服务，每天检查这个，只有当索引百分比达到一定的配置水平时才通知。那么我们该如何做呢？刮擦是解决方案的一部分。

# [](#the-how)该如何如何

首先，我们必须考虑到基于抓取的商业模式是非常危险的，所以我们不想花太多时间开发这个*附带项目*，我们也不想 100%依赖抓取。我选择 python 是因为它非常适合抓取，所以我选择了 Django。现在我使用 beautiful soup 进行抓取，使用[芹菜](http://celery.readthedocs.org/)进行并行处理，用 RabbitMQ 作为消息代理，Redis 临时存储结果。那么亚马逊是怎么防止刮擦的呢？首先，它们会阻止每秒发出 1 个以上请求的 IP，所以我不得不使用 Storm Proxies 来改变每个请求的 IP。这应该够了吧？嗯，这还不够，亚马逊认识到当一个请求没有 cookie，所以当多个请求时，他们会显示验证码。那么有可能生成 cookie 吗？嗯，亚马逊会在他们的 cookies 上签名，所以创建一个是不可能的，至少我是不可能的。如果显示验证码，我们使用亚马逊 API 来获取我们需要的数据，所以我们不完全依赖抓取。抓取 Amazon 一直是一个相当大的挑战，为每个请求更改 IP 的服务增加了近两秒的延迟，所以完全有必要使它并行，因为如果我们不这样做，每个关键字将需要两秒，而不是最多 250 个关键字需要两秒，或者至少理论上应该是这样。有时一个关键字会持续一分钟以上，这对用户来说太长了，所以有必要添加超时和速率限制，以免服务器过载。

目前，我们有 243，431 个关键字被编入索引，并且每天增加大约 14k，记住，每个关键字一个请求。

如果你想检查这里的服务，它是:[检查我的关键字](https://checkmykeywords.com)