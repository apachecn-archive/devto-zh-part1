# 没有版本控制就没有干净的(数据库)开发

> 原文：<https://dev.to/pesse/there-is-no-clean-database-development-without-version-control-3dom>

当我为这篇当前的博客文章做了一点研究，并了解到第一个版本控制系统 [SCCS](https://en.wikipedia.org/wiki/Source_Code_Control_System) 是在 1972 年发明的时候，我感到很惊讶。那是 45 年前的事了。我甚至还没出生。

但是即使在今天，经过这么长时间，仍然有项目——尤其是数据库项目——不在版本控制之下。我自己记得我参与的几个项目(或者甚至是负责的，真可耻)根本不受版本控制，或者至少数据库部分不受版本控制。那么为什么会这样，我们能做些什么来对抗它呢？

## (根本)为什么要版本控制？

版本控制系统(VCS，也称为 SCS(源代码控制系统)或 SCM(源代码控制管理))是一种跟踪文本文件更改并存储更改历史的工具。它允许检查任何以前版本的受控文件。现代 VCS 还提供自动解决方案，将来自不同来源的多个变更合并到同一个文件中。如今，最被接受和使用的 VCS 是[吉特](https://git-scm.com/)、[水星](https://www.mercurial-scm.org/)和 [SVN](https://subversion.apache.org/) 。

[Git-Tower](https://www.git-tower.com/learn/git/ebook/en/desktop-gui/basics/why-use-version-control) ，Git 的一个学习平台，列举了以下使用版本控制的理由(点击链接阅读完整推理):

*   合作
*   了解发生了什么
*   支持
*   存储版本(正确)
*   恢复以前的版本

在我看来，版本控制给了开发者一个特别的东西:安全。如果您的代码是受版本控制的，您就不会冒丢失过去所做的东西的风险，您也不需要害怕严重破坏某些东西(只需返回)，您也不必害怕忘记为什么要进行更改(您总是可以与以前的情况进行比较)，并且您可以从 bug 和错误中学习，因为您可以找到错误代码在项目中的确切位置和时间。你可以在一个比外面更舒适的环境中编码。

当然，版本控制提供的远不止这些(例如，考虑自动化文档和发行说明)，但是我认为这是使用版本控制的最强有力的论据之一——无论何时何地。你想让你的编码区域尽可能安全舒适，因为不确定性和恐惧是**专注和创造力**的最大杀手(在我看来，这是一个高效软件开发人员最重要的属性)。

## 数据库是不同的动物

那么，为什么仍然有许多与数据库相关的项目没有或者只是部分处于版本控制之下呢(是的，这是一个非常主观的观察)？为什么数据库人员特别渴望在日常工作中使用 VCS？

这是因为与应用程序开发相比，数据库是不同的动物。让我列出最具影响力的差异:

| 应用程序 | 数据库 |
| --- | --- |
| 每次构建都会创建一个全新的、可部署的应用程序。 | 通常，在构建过程中不会从头开始重新创建数据库。更改将应用于现有数据库。 |
| 回滚非常容易，只需签出以前的版本并构建它。 | 数据库中的回滚非常复杂、昂贵且耗时。有时，不丢失数据几乎是不可能的。 |
| 文件名(类等。)保持原样，不要经常换。 | 更新文件有不同的名称。每个更新都可以有自己的脚本集，这些脚本仅对该特定更新有效。 |
| 通常，初始安装与安装更新的过程完全相同。 | 初始安装与安装更新完全不同。有时您甚至不能或不被允许影响数据库的安装。部署过程有很大的不同。 |
| 你通常从一开始就处理文本文件，并且贯穿整个开发过程。 | 默认情况下，像过程、包、视图这样的东西并不存储为文本文件。它们存在于数据库中。如果你不做额外的工作，你可能根本不会遇到文本文件。 |

面对这些额外的挑战可能是数据库开发人员远离将版本控制引入他们的数据库项目的一个原因。我们甚至必须完全排除前面列出的两个主要原因:

*   存储版本(正确)
*   恢复以前的版本

对于受版本控制的应用程序来说，这些任务非常容易，但是对于数据库项目来说，它们甚至可能是不可能的，或者至少需要额外的工作。

这是在数据库项目中避免版本控制的理由吗？这是因为数据库开发中的额外挑战而避免敏捷方法的原因吗？

我不这么认为。我绝对相信——尽管这可能更加困难——拥有一个安全的开发区域，并在日常工作中包含像重构和自测这样的敏捷方法，对数据库开发和应用程序开发一样有益。版本控制是实现这一目标的先决条件。

## 如何开始？

开始对数据库源代码进行版本控制的最大挑战之一是如何将它们转换成文本文件。我们数据库开发人员并不习惯用文本文件保存源代码——我们有自己的数据库、查询工具和最喜欢的 IDE。

是的，有一些解决方案可以让您在不改变工作方式的情况下对源代码进行版本控制(看看一些 redgate、apex 或 toad 产品)。缺点是这些工具相当昂贵。毫无疑问，它们很棒，但说服你的经理购买一些四位数的软件，开始做应用程序开发人员免费做的事情，这本身可能就是一个挑战。特别是如果它是一个按年许可的软件，在这种情况下，您将自己和您的开发捆绑到一个特定的供应商。

另一件事是那些工具不会为你做所有的事情。根据我的经验，敏捷和干净的工作首先是心态和行为的改变(我很确定我会在未来的博客文章中写更多)。

那么我们能做些什么呢？你是开发商！不要忘记这一点。您有能力让机器做您想做的事情，因此使用这种能力来自动获取存储在数据库中的源代码，并将它们写入您可以进行版本控制的文件结构中。在大多数数据库中，很容易找到源代码，这里有一些链接可以帮助您入门(您也可以很容易地看到其他人已经遇到了同样的问题，并且已经解决了):

*   [堆栈溢出](https://stackoverflow.com/questions/29360699/how-to-automate-source-control-with-oracle-database)
*   [甲骨文-ddl2svn](https://code.google.com/archive/p/oracle-ddl2svn/)
*   [Visual Studio SQL Server 数据工具](https://www.visualstudio.com/de/vs/ssdt)
*   大多数商业数据库 ide 都有一个功能，可以(至少在最初)将所有的 ddl 写到一个文件结构中

## 数据库到文件还是文件到数据库？

有了从数据库获取源代码到文件结构的工具后，继续直接在数据库上工作可能很有诱惑力，可能需要一些不错的 IDE、拖放和所有那些花哨的东西。

我不推荐这种做法。相反，我鼓励您开始处理这些文件，并运行它们以将更改导入数据库。例如，在您最喜欢的文本编辑器(最好使用 intellisense)中使用 Oracle 存储过程主体来编辑您的文件，然后针对您的开发数据库运行它(对于 SQL Server 过程来说，这可能有点复杂，因为您没有“创建或替换”功能，但 SQL Server 2016 有“创建或更改”功能，对于旧版本，还有[解决方法](https://www.red-gate.com/simple-talk/sql/database-administration/using-migration-scripts-in-database-deployments/))。

自动化迁移将变得更加容易，一旦你更深入地研究敏捷数据库开发，你将会越来越多地接触到文件。与你最喜欢的文本编辑器建立密切的关系将变得像磨练你的 sql 技能一样有益。

## 什么要版本控制？

除了明显的版本控制能力，您还可以使用 VCS 作为备份和中央存储。把所有你需要的东西放在一起。

### DDL

首先，当谈到版本控制源代码时，我会谈到 Schema/DDL。这包括包、过程、函数、触发器、对象的 SQL，还包括表、视图、物化视图、序列等。

这是源代码中最重要的部分，也是最容易进行版本控制的部分。将您的 DDL 语句保存到文件中，并从那里开始工作。

### 数据

版本控制数据是一个独立的主题，但长话短说:可能有一些数据是您的项目工作所必需的。数据，如配置设置、基本定义和其他常规数据。

您应该编写这些数据的脚本并对其进行版本控制。如果您的项目中有客户相关的数据，您也应该考虑版本控制，也许在不同的客户相关的存储库中。

### 安装-文件

如果您能够轻松地在本地机器上安装您的数据库项目，这绝对是一件好事。如果您有机会编写安装步骤的脚本，那么就这样做，并将脚本文件置于版本控制之下。

### 片段

你知道片段吗？大多数 ide 都有可能存储代码模板并通过快捷方式插入它们。他们中的大多数还允许将这些片段存储为文件。这是一个很好的机会，可以开始扩大你的个人生产力提高模板和代码片段库，并对它们进行版本控制。

如果您有多个项目的代码片段，将它们存储在一个单独的存储库中以使它们独立于您的特定项目也是一个好主意。

### 首选项

让您的 IDE 或文本编辑器的首选项也受版本控制可能会很有用。这对于特定于项目的首选项和通用首选项都是有效的——尽管通用首选项可能应该存储在单独的存储库中。

但是，对于特定于项目的首选项可能有一个例外:如果您正在与一个使用不同 ide 和工具的大型团队一起工作(例如开源项目)，特定于项目的首选项不应该污染存储库。

对于较小的团队和项目，如果您同意使用一个开发环境和工具集，将首选项与您的源文件紧密地存储在一起会有很大的帮助。

## 什么不要版本控制？

在我看来，这是一个非常情境化的问题。我会试着给出一些想法，但是你永远不应该创造一个教条。请记住:任何有助于使你的项目更容易维护、更容易理解和更容易发展的东西都是有益的——不管某些指南对特定主题说了什么。

### 二进制文件

一般来说，我会说所有种类的二进制文件(想想数据库转储，压缩档案，图像，可执行文件等。)是您不希望污染您的存储库的——VCS 无法跟踪二进制文件的更改，并且总是存储文件的全新副本，这可能导致资源浪费。

但是在某些情况下可能会有例外。考虑一个项目，它在某个时候需要一个特定版本的自动化编译工具——将这个工具包含在您的 VCS 中可能会很有用，这样当您需要在项目中工作时，它肯定是可用的。

或者您有一个遗留(数据库)项目，您不能通过 SQL 安装文件创建项目的新实例，但是您有一个转储作为实现的起点。在这种情况下，将这个转储与安装文件的其余部分一起存储是完全有效的。

作为一个经验法则，我认为如果二进制文件是项目的必要组成部分并且不经常改变，那么在你的存储库中有二进制文件是没问题的。

### 自动生成代码

您的代码中可能有一些部分是从其他源代码和定义文件中自动生成的。

一般来说，您不应该对自动生成的代码进行版本控制，但是您当然应该对自动生成它的代码和源代码定义进行版本控制——以及自动生成它的可能性(例如 python 脚本)。

这对于手动生成后**未调整的自动生成代码有效。如果您更改了以前自动生成的代码，它就不再是自动生成的了:那么您肯定应该将它置于版本控制之下——或者考虑如何改进您的代码生成器，以达到结果不必更改的情况。**

在任何情况下:如果你使用代码生成器，确保它清晰易懂，易于建立一个开发环境，并获得你的项目工作所需的东西和代码。如果你对你的项目了解不多的人不能使用它，那么最好的代码生成器是没有用的(是的，这可能对一个人的项目无效，但是我们开发专业人员真的有多希望在一个人的项目中工作呢？你应该努力保持墙壁加入你的项目小)。

## 什么时候开始？

很简单:现在。

老实说，我不认为有任何理由不立即开始将你的数据库项目置于版本控制之下。

这样做的努力是相当低的——我无法想象这样一种情况，即开始将花费你超过一个或最多两个工作日的时间(如果你还不熟悉 VCS 的话)。

不要误解我的意思:要找到组织文件的最佳方式，以一种增强版本控制的方式工作并尽可能地控制版本是一个漫长而具有挑战性的过程，可能永远不会结束，但是开始使用 DDL 或者至少是 DDL 的功能部分(包、过程、函数、触发器和视图)是一个非常简单的任务。

您可能必须熟悉版本控制的概念，您可能必须开放您的思维，您可能必须质疑您以前做事情的方式，但是请记住，您是一名开发人员，持续改进您的知识和技能应该是您心态的一部分，就像对尝试新方式感到好奇和兴奋一样。

如果你的目标不仅是提高项目的特性集，而且是提高代码的质量和项目的可靠性、可维护性和可发展性，这一点尤其正确。因为没有版本控制就没有干净的数据库开发。你还在等什么？

*本帖原载[此处](https://cleandatabase.wordpress.com/2017/09/22/there-is-no-clean-database-development-without-version-control/)T3】*

[![](img/e9f5d18d59faa9797ecbc88e7b656e70.png) ](http://feeds.wordpress.com/1.0/gocomments/cleandatabase.wordpress.com/194/) [ ![](img/6884aaf9c789527efc1a48bff287d992.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--EwHSHFE---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://pixel.wp.com/b.gif%3Fhost%3Dcleandatabase.wordpress.com%26blog%3D134663363%26post%3D194%26subd%3Dcleandatabase%26ref%3D%26feed%3D1)