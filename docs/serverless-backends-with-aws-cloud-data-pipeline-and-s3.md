# AWS 云的无服务器后端:数据管道和 S3

> 原文：<https://dev.to/rob117/serverless-backends-with-aws-cloud-data-pipeline-and-s3>

这是 AWS 无服务器架构系列的一部分。在这里和我的博客 [J-bytes](http://robsherling.com/jbytes/index.php/2017/01/08/serverless-backends-with-aws-cloud-intro/) 上都可以找到原始的博文系列。

# 管道热数据

我们将把数据从 Dynamo DB 转移到本地环境中。稍后，我们将解密它，用它做一些很酷的事情。如果你一直在跟进，这一部分非常短。

如果您使用 RDS 而不是 DynamoDB，您可以直接使用 RDS(稍微贵一点，瓶颈等等)。然而，如果你使用 DynamoDB，我们真的不能使用 lambdas 向我们的用户发送 tweets。它们一次最多只能工作 5 分钟，并不是真正为一次扫描 100K+记录的数据库和发送消息而设计的。我们可以构建工具将数据留在数据库中，并在那里使用它，但我认为更简单的方法是下载所有数据，将其放入本地 MySQL 实例，然后根据需要发送推文或收集电子邮件。

当然，您也可以在 EC2 spot 实例上这样做，这是一种廉价、强大的方式，可以大量通知您的追随者。

## 创建数据管道

这是整个项目中最容易的部分。进入 S3，创建两个桶(或文件夹，选择完全由你决定):
`<Project-name>-production-email`
`<Project-name>-production-twitter`

如果需要，您还可以再创建两个用于暂存，但出于演示的目的，从现在开始我将只使用生产。步骤是相同的，并且非常容易复制。

创建存储桶后，在 AWS 控制台中打开数据管道。注意:如果您的数据库中实际上没有东西，那么您的管道就没有东西要传输。在继续之前，请确保您的生产电子邮件和 twitter 数据库实际上至少各有一个项目。你可以通过邮递员来做。

*   如果您的地区不受支持，请选择一个地区
*   单击立即开始
*   对于**的名字**，选择一些极其复杂的东西，比如“生产-电子邮件-管道”
*   在**源**下，选择将 DynamoDB 表导出到 S3
*   对于**源 DynamoDB 表名**,选择确切的表名——production _ emails
*   您的输出文件夹应该是您刚刚在 S3 创建的正确文件夹。
*   **DynamoDB 读取吞吐率**取决于您的项目。对于我的项目，管道应该在活动结束后运行，并且不再有传入的请求，所以 1.0 很好。当它从你的数据库中读取数据时，它会耗尽读/写容量，所以你要聪明地设置它。
*   DynamoDB 表格的区域——设置表格所在的正确区域。
*   **计划- >运行**将其更改为“管道激活时”
*   禁用日志记录。对我们来说不重要。
*   默认 IAM 角色。
*   点击**激活**。
*   它会对你大喊验证警告。大笑，然后点击**再次激活**。这里没有遗憾。
*   等待 10 分钟，这取决于你无法控制的因素。如果您的调度状态显示“按需调度”，您可能需要等待并手动刷新。此页面似乎不会自动刷新
*   在 S3 无服务器生产文件夹/存储桶中，您应该会看到一个包含今天日期的文件夹。在里面，你会看到三个文件。忽略“_ 成功”和“清单”我们想要一串废话。下载吧。
*   对 twitter 表重复以上所有操作。

仅此而已。接下来，我们将在本地环境中编写一些快速、简短的程序来解密和使用所有这些数据。