# 软件测试和信心

> 原文:[https://dev . to/plain programmer/software-testing-confidence-51ap](https://dev.to/plainprogrammer/software-testing-confidence-51ap)

[![](../Images/54c3bd4e6f4bc5545baf60326d815997.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--CSP_Emh4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://james.thomps.onl/wp-content/uploads/2019/07/044ce-13kvy25v-po1yotwulzzfyg.jpeg)

当我们构建软件时，有时会觉得这是一种不稳定的平衡行为。下一段代码会达到我们的预期吗？我们没有改变的事情会开始变得奇怪吗？对许多软件开发人员来说，确定性和信心并不总是触手可及。

能够更自信地回答这些问题是软件测试如此重要的原因。十多年来，我一直是测试驱动开发的实践者。它让我成为一个更好的软件工匠，帮助我从程序员转变为开发人员，现在我认为自己是一名软件工程师。而且，随着新的软件架构范例的不断出现和发展，我从好的测试中获得的信心对我的工作仍然很重要。

* * *

### [](#layers-of-testing)层层测试

在过去的几个月里，我一直在为 [Nav](https://www.nav.com/) 开发一项新的微服务。它旨在取代现有的服务，因此它必须满足多个标准。它需要提供与现有服务一定程度的对等性。它需要在自身功能的基础上增加附加值。此外，它必须支持现有服务中的数据以及生态系统中其他服务的迁移路径。

服务级单元测试可以轻松处理前两个标准。我早就养成了一个习惯，从 100%的 C0 代码覆盖率开始，不允许遗漏。但是，这只给了我信心，我的代码如预期的那样工作，特别是正如我在测试中描述的那样。而且，如果这是一项新服务，而不是要取代其他任何东西，那么这些测试会给我足够的信心在我们的生态系统中发布这项服务。但是，我上面描述的第三个标准是令人担忧的。因为该标准涉及到与其他系统的交互，所以另一层测试是必要的。

不幸的是，这一层的跨服务测试更具挑战性，但也是必要的。我需要为当前活动的新旧服务之间的通信获得信心。将有一个 ETL 阶段带来旧数据，这将需要手动确认。最后，还需要确认依赖旧服务的服务可以与新服务交互。

### [](#externalities-add-difficulty)外部性增加难度

对于我的工作，我们有一个消息传递系统来支持新旧服务之间的异步通信。我进行了模拟消息传递系统的测试，以确保我们正在尝试做正确的事情。但是，对于这两种服务，我需要增加我的信心，确保消息实际上被正确发送。这意味着我需要测试发送的消息和接收这些消息的服务的动作。

第一步是添加测试，以确认正确的消息被传递到消息传递系统。这些测试需要一些细致的工作，因为添加对消息传递系统的依赖意味着引入了延迟。我不得不在测试中加入等待时间，这使得测试速度变慢了，但也只是稍微慢了一点。幸运的是，我们在开发机器上使用 Docker，因此为本地测试设置消息传递系统非常容易。

在我建立测试以确认正确的消息到达消息传递系统之后，我继续确保在服务上发生正确的动作。这引入了另一个需要更仔细测试的依赖性。但是，我可以断言，在两个服务都运行的情况下，当一个服务上发生事件时，另一个服务就会触发相应的操作。我编写了测试来从两个方向证实这一点。

通过这些测试，我确信这些服务能够正确交互。这就是我们的目标。还有其他需要管理的细节。确保对信息系统有适当的期望是很重要的。了解当一个服务暂时无法处理入站消息时，系统会如何运行。每一个都是关于提高自信的。而且，只要有可能，这种信心会得到自动化测试的支持。

### [](#the-unacceptable-alternative)不可接受的替代方案

现在，这听起来可能需要做很多工作，确实如此。但这是绝对必要的。没有测试的代码是有缺陷的。而且，在微服务生态系统中，这导致了没有测试的协作服务是有缺陷的断言。如果两个服务明确地相互依赖，但是它们的实际交互从来没有被测试过，那么就没有可再现的证据证明它们可以一起工作。

> 没有测试的代码是有缺陷的，没有测试的协作服务也是如此。

另一种选择是对系统的预期行为缺乏信心。另一个选择是不确定性。而且，现实是 ***希望不是一个好计划*** 。

* * *

测试对于软件开发来说是一种不可思议的实践，它会让开发者和他们的软件变得更好。Noel Rappin 在 RubyConf 2017 上有一个关于 [*高成本测试和*](https://youtu.be/IS_9cRP9OZM) 高价值测试的精彩演讲。对于那些对测试微服务的更多细节感兴趣的人，我推荐这个来自 2017 年伦敦 O'Reilly 软件架构大会的演讲，名为*现实被高估:微服务测试的 API 模拟*、[第一部分](https://www.safaribooksonline.com/library/view/oreilly-software-architecture/9781491985274/video315474.html?utm_medium=affiliate&utm_source=cj&utm_campaign=paid&utm_content_cj_12989168_1)和[第二部分](https://www.safaribooksonline.com/library/view/oreilly-software-architecture/9781491985274/video316851.html?utm_medium=affiliate&utm_source=cj&utm_campaign=paid&utm_content_cj_12989168_1)，可通过 [Safari 在线书籍](http://www.jdoqocy.com/click-8483885-12989168)获得。