# 误差预算:谷歌持续创新的解决方案

> 原文：<https://dev.to/danlebrero/error-budget-googles-solution-for-innovating-at-a-sustainable-pace>

*本文原载于[我的博客](http://danlebrero.com/2017/07/16/error-budget-google-solution-for-innovating-at-a-sustainable-pace/)T3】*

用接下来的一两个 sprint 来偿还你的项目积累的一些技术债务不是很好吗？改进日志记录以减轻支持不是很好吗？或者增加一些额外的集成或者端到端的测试？或者，也许先采取这些步骤来实现蓝/绿部署？

但是，你的产品负责人最近一次愿意在下一个 sprint 中加入这些技术故事是什么时候？

在构建或改进业务特性和那些技术项目之间总是存在一种紧张关系——有些是技术债务，有些是技术改进——它们不会给产品所有者带来非常明显的业务利益。

功能似乎总是胜过任何技术工作。

少数技术工作确实有一些明显的商业利益。例如，如果我们提高 20%的性能，我们可以减少 20%的 AWS 费用。

但大多数时候，技术工作对产品所有者的好处是显而易见的，就像从 286 升级到高速 386 对你父母的好处一样。我从来没有成功地把它卖出去。

那么对于绝大多数的技术工作，除了依靠自己糟糕的谈判技巧，我们还能做什么呢？

谷歌的[网站可靠性工程(SRE)书](https://landing.google.com/sre/book.html)提供了一个可能的答案:[错误预算](https://landing.google.com/sre/book/chapters/embracing-risk.html)。

## 什么是误差预算？

每个服务都应该有一些服务级别目标(SLO)，这就像一个软 SLA，没有任何罚款，如果错过了也不会有律师介入。

服务的 SLO 将取决于服务不可用时的影响。SLO 应该由业务部门来定义，因为他们应该知道停机的声誉或金钱成本是多少。

计算服务可用性的常用方法是查看其正常运行时间与计划外停机时间:

*可用性=正常运行时间/(正常运行时间+停机时间)*

但是在 SRE 的书中，他们提出了一种不同的计算可用性的方法:

*可用性=成功的请求/(成功的请求+失败的请求)*

失败的请求可能是:

1.  一个 500 的回应，由于一些错误。
2.  由于服务中断，没有响应。
3.  缓慢的响应:如果客户端在响应可用之前就放弃了，那就相当于没有响应。
4.  由于一些错误，数据不正确。

有趣的是，公共基础设施中的中断会导致这些故障，其思想是公共基础设施的可用性是每个人的责任。

根据可用性的定义，我们可以将误差预算定义为:

*错误预算= (1 -可用性)=失败的请求/(成功的请求+失败的请求)*

因此，如果服务 SLO 为 99.9%，则误差预算为 0.01%。如果服务每个季度服务一百万个请求，错误预算告诉我们它可能失败一万次。

## 谷歌对错误预算的使用

SRE 的书解释了产品团队和 SRE 团队之间的紧张关系，前者根据他们交付新功能的速度来评估，后者根据系统的可靠性来评估。

现在我们知道了一个服务的误差预算是多少，前提是产品团队一旦使用了误差预算，不花时间提高服务的可靠性，就不能再做任何新的发布。

此外，如果产品团队快要用完他们的错误预算，他们自然会对发布什么和发布的频率更加谨慎，因为他们希望降低违反预算的风险。

因此，误差预算作为一种可衡量的、客观的、自我监督的机制，平衡了创新与可靠性。

## 谈判技术工作

我从未在有 SRE 团队的公司工作过，所以以我的经验，SRE 书中描述的紧张关系实际上是在开发团队和产品负责人之间，开发团队希望有时间做好事情，并对他们服务的可靠性负责，而产品负责人通常只想提供越来越多的功能。

那么为什么不计算你自己的误差预算，并用它来决定团队什么时候需要放慢速度，把更多的注意力放在保持项目良好状态的技术工作上呢？

当团队已经使用或接近使用预算时，团队必须花费他们的时间来提高服务的可靠性，通过[提高系统的测试套件和监控能力](http://danlebrero.com/2017/06/05/testing-or-monitoring-mtbf-mttr-make-your-choice/#content)，通过实现一些弹性模式，通过自动化更多的部署管道或通过提高系统的性能。

但是，要有一个可靠的系统，我们还必须有一个简单和干净的代码库，以及一个简单和干净的架构，因为正如 Dijkstra 所说:

> 简单是可靠的前提。Edsger W. Dijkstra，我们如何说出可能会伤害到你的真相？

所以大的重构和重新架构自然会落入这个可靠性的陷阱。

但是我们可以想象一些产品所有者甚至在误差预算已经耗尽的情况下还在争取更多的特性。

这应该没问题。产品所有者拥有 SLO，所以她可能会选择降低它，选择功能而不是可用性，但至少决策和权衡是清楚的。

因此，在某种程度上，错误预算也有助于确定服务的实际所需可用性，使权衡更加明显，决策更加清晰，产品所有者更加负责。

所以做你的数学，看看你的日志，看看你是否有一个令人信服的理由来安排一些技术改进。

* * *

误差预算只是 SRE 书中许多有用见解中的一个。它甚至详细描述了一次[准宕机](https://landing.google.com/sre/book/chapters/automation-at-google.html#xref_automation_diskerase-sidebar)，其原因和解决方案与[亚马逊 2017 年 2 月 S3 宕机](https://aws.amazon.com/message/41926/)非常相似。

如果有兴趣，这本书可以在 https://landing.google.com/sre/book.html 免费获得