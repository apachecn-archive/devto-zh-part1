# Webhooks vs 无服务器

> 原文:[https://dev.to/oktadev/webhooks-vs-serverless-1end](https://dev.to/oktadev/webhooks-vs-serverless-1end)

[![Monster Battle](../Images/1f815d63268b1f6adfd5c317b0bd66fa.png)T2】](https://res.cloudinary.com/practicaldev/image/fetch/s--F4NNa1Xw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/h55d2yljig5h88o0f4k3.jpg)

当您构建了一个成功的软件即服务产品时，您往往会遇到有趣的技术(和业务)问题。我最喜欢的问题是:“我们如何更快地向我们的平台添加更多功能？”这是一个有趣的问题，因为每个人都想更快地构建功能。

在一个完美的世界里，你可以雇佣 100，000 名工程师，把他们分成四个小组，没有经理！让每个团队都拥有一个特性:详细说明它，构建它，根据用户反馈迭代它，并且与其他团队完美地合作。

但是让我们现实一点。这不是一个完美的世界，一家公司不可能让四名工程师在一个没有管理的团队中工作！

因此，虽然您可能无法以足够快的速度构建功能以跟上您的产品和用户的增长，但您可以通过一个流行的技巧来规避它:平台可扩展性。

不需要你的工程师坐下来开发每一个用户曾经要求的每一个功能，你可以把你的产品变成一个“平台”,你的客户的开发人员可以在这个平台上进行构建。这样，如果客户非常需要某个特性，他们可以集成您的平台 API 和 BAM:以前不可用的特性现在可以使用了！很巧妙。

那么你(作为一个成功的企业主)如何允许其他开发者扩展你的平台呢？你有很多选择。然而，它们中的大多数都很糟糕，所以我只讨论最流行的两种:webhooks 和 serverless。

## [](#serverless-is-the-answer)无服务器就是答案！

如果你在过去几年里(具体来说，从 2014 年开始)一直关注互联网宣传，你会熟悉“无服务器”这个术语，也称为“lambdas”、“功能即服务”等。

所有这些术语基本上指的是一种被称为*无服务器可扩展性*的模式。

为了适应您的客户扩展您的平台，您允许他们上传一些代码到您的服务器，当您的产品中发生某些事件时，您将运行这些代码。

我给你举个好例子。

假设你正在构建一个应用托管平台(*a-la[Heroku](https://www.heroku.com/)T3)。Heroku 提供的功能包括运行应用程序代码、记录错误和提供基础设施(数据库等)。).*

如果客户正在使用您的平台，并希望在每次配置新数据库时都向他们的会计团队发送电子邮件，这可能有点棘手，除非您的平台提供了这样做的功能或可扩展性选项，以便客户可以自己完成。

因此，您决定允许无服务器扩展性。客户现在可以在每次提供新的基础设施时上传一些代码(用 JavaScript 编写)在您的平台上运行。

客户通读了您的文档，并编写了一个类似这样的小函数:

```
module.exports = sendEmail(event) {
  if (event.type === "provision" && event.service === "database") {
    // some code to send an email to the accounting department
  }
} 
```

<svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title></svg> <svg width="20px" height="20px" viewBox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title></svg>

然后上传到你的网站。

这对客户来说非常酷！无需打扰您，也无需等待您的工程团队开发出这种电子邮件功能，他们就能够编写一些代码来完成他们想要的功能！

客户不仅可以在配置基础架构时“挂钩”到您的平台，还可以在任何地方挂钩！您的平台提供了大量不同的可扩展性选项，使客户能够在几乎每个主要平台事件之后或之前运行他们的代码！

这有几个核心好处:

*   客户可以轻松地构建他们需要的功能，而不会受到工程团队速度的限制
*   你失去的客户更少，因为他们现在有办法解决你产品中的问题
*   您能够更快地迭代您的核心平台产品，因为您现在能够缩小范围

## [](#the-flip-side-of-serverless)无服务器的另一面

现在，您已经为您的客户构建了无服务器可扩展性功能，您已经打开了无限量的定制选项。但是代价是什么呢？

John 是您最大的客户之一，他负责工程设计，但他并没有同意这么做。您的无服务器可扩展性为他和他的团队创造了一系列正在进行的工作:

*   他必须弄清楚你的无服务器功能是如何工作的，有哪些钩子可用，等等。这是一个很高的学习曲线，需要他的所有工程师对你的产品有一个透彻的理解，才能有成效。
*   因为您的无服务器平台目前只支持运行 JavaScript ES5 代码，John 的 C#工程师团队在用他们并不熟悉的 JavaScript 编写复杂的应用程序逻辑时遇到了问题。
*   约翰的团队对你的无服务器平台如何运行他的代码没有任何洞察力:他们不知道如何监控服务器资源，如何进行适当的单元和集成测试，如何寻找故障，等等。
*   约翰的团队现在不得不在许多不同的地方管理代码，而不是只有一个 GitHub 库。现在，John 团队编写的每个无服务器功能都必须手动上传到平台网站的正确位置，并不时进行维护和更新。因为没有直接的方法将这些无服务器的功能集成到团队现有的代码库中，所以这些代码现在分散在您的平台上，这使得很难处理。
*   约翰的团队现在处于一个棘手的安全状况:他们必须编写专有代码并将其存储在您的平台上。他们还必须存储敏感凭据，如电子邮件帐户信息，以及运行无服务器软件所需的任何其他相关凭据。约翰公司的安全团队并不兴奋。

公司越大，挑战就越大。在不同的工程师团队之间进行协调，找出某个特定功能的位置，这既困难又耗时。更新以前的钩子变成了对耐心的考验。团队代码库的文档变得非常庞大，包括了编写、更新和维护这些无服务器钩子所需的所有特定领域的知识。

这些副作用否定了最初目标的目的:让客户更快地获得他们需要的功能。

这些只是你会注意到的*客户面临的*副作用。这会给你和你的公司带来一大堆其他的麻烦:

*   您必须构建安全、隔离的代码执行环境，以便在沙箱中运行客户代码。这在实践中非常困难。如果你在谷歌上搜索“ [docker escalation](http://lmgtfy.com/?q=docker+escalation) ”，你就会明白我的意思了。甚至像 Amazon Lambda(第一个真正无服务器的播放器)这样拥有庞大安全团队的神奇服务也可能让自己暴露在有趣的[安全](https://www.youtube.com/watch?v=YZ058hmLuv0)问题中。
*   您必须确保尊重客户的软件知识产权，这些知识产权目前正在您的基础架构中运行
*   除了担心自己的服务问题，您还必须扩展您的基础设施以支持任意数量的客户代码
*   您必须公开越来越多的透明工具，以允许您的客户更深入地了解您的系统:错误日志、性能监控等。这个清单最终会一直延续下去。
*   你必须写文档来解释你所支持的每一个钩子以及它是如何工作的。你还必须向用户展示如何上传代码到你的平台，如何测试，等等。

底线？从工程角度来看，将无服务器可扩展性功能构建到您的产品中可能是您做过的最昂贵的事情——对您和您的用户都是如此。

## [](#webhooks-going-beyond-serverless-extensibility)Webhooks，超越无服务器扩展性

webhooks 是一种经过一次又一次测试的老方法。尽管 webhooks 无论如何都不“古老”，但它们比无服务器可扩展性模式至少早了 7 年。我的好友杰夫·林赛在 2007 年创造了这个术语。

webhooks 背后的想法很简单:代替在*平台*上运行客户代码的*你*，你只需要在每次有事情发生时向客户发送一个 HTTP POST 请求，然后客户就可以基于这些传入的请求执行他们需要的任何逻辑。

简单吧？

这是一个很好的方法，因为对于所有相关方来说，它更易于管理和扩展。

这对你的公司来说更简单，因为你现在只需要在事件发生时发出 HTTP 请求。你不需要担心执行别人的软件，伸缩它等等。您必须做的最复杂的事情是重试失败的 HTTP 请求(无论如何，这对于几乎所有的 HTTP 请求都是强制性的！).

## [](#webhooks-in-the-wild)野外的网钩

### [](#twilio)Twilio

Twilio 是世界上最著名的 API 服务之一。Twilio 提供 API 服务来管理电话内容:电话、短信、彩信等。

从第一天开始，Twilio 就在他们的平台中提供了核心的 webhook 支持。

假设您正在构建一个 SMS 应用程序:

*   你通过 Twilio 购买一个电话号码
*   每当该电话号码收到一条短信，Twilio 就会向您的 web 服务器发送一个 HTTP POST 请求，其中包含消息数据
*   然后，您接收到一个对您的 web 应用程序的 HTTP POST 请求，在那里您解析请求，找出消息的内容，然后采取一些行动(*也许您发送一个响应，例如*)

使用这种简单的来回消息传递模式，webhooks 允许 Twilio 客户轻松地与平台集成，轻松构建高价值的应用程序。

**注意**:我在 Twilio 的好朋友[卡特·拉巴萨](http://carter.rabasa.com/)最近发布了对无服务器可扩展性*的支持，此外还有他们的核心 webhook 支持*。这是一个聪明的举动，因为它们现在吸引了每个人(*)，甚至是疯狂喜欢无服务器可扩展性模式的人！*)。

### [](#heroku)Heroku

还记得之前无服务器示例中的 Heroku 吗？希望如此！

Heroku 的应用托管平台最近开始[支持 webhooks](https://blog.heroku.com/heroku-webhooks) ，这是我梦寐以求的一切，甚至更多！

Heroku 客户现在能够轻松地在 Heroku 上连接他们的应用基础设施，并执行复杂的逻辑来更轻松地扩展他们的服务，降低成本，让他们的运营团队了解问题等。

### [](#github)Github

GitHub webhooks 一直存在，并且是许多流行的开发者服务的基础，如 [Travis CI](https://travis-ci.org/) 。

GitHub webhooks 允许您挂接几乎所有可以在源代码库上执行的操作。它们非常适合分析代码、跟踪团队表现、自动化测试和部署，以及许多其他优秀的用例。

## [](#webhooks-in-your-product)产品中的 Webhooks

对您和您的客户来说，实现无服务器可扩展性都很困难。虽然有一些人更喜欢它，但它对每个人来说都是一项繁重的工作。

作为一个已经开发开发工具和 API 服务将近 17 年的人，其中一个工具和服务每月产生近 300 亿个 API 请求，我鼓励你花一些时间来思考开放平台进行定制的最佳方式。

选择错误的可扩展性选项可能是一个令人痛苦的错误，因此考虑这两种方法的利弊，选择对您最有意义的是一个好主意。

如果你需要一些帮助来决定，请[给我发短信](//mailto:randall.degges@okta.com)或者[发微博给我](https://twitter.com/rdegges)，我很乐意帮助你。

## [](#summary)总结

虽然无服务器可扩展性和 webhooks 服务于相同的目的，但一个比另一个简单得多。

Webhooks 是复杂问题的简单解决方案，而无服务器可扩展性是复杂问题的复杂解决方案。

在计算机科学领域，以及职业和个人生活的许多其他领域，我喜欢走简单的道路。

我希望这是有用的。

兰德尔