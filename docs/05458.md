# 设计您的系统，就好像它们已经着火了一样

> 原文：<https://dev.to/liquid_chickens/design-your-systems-as-if-theyre-already-on-fire>

你在给每个人做昨晚停电的尸检。您已经描述了问题，您已经详细说明了根本原因和补救措施，团队即将讨论学到的经验教训和行动项目。

有人(可能是你的经理)问:“我们如何确保这种事情不再发生？”

在你回答之前暂停一下。至少有两种方式来解释这个问题:

1.  **字面解释** -我们如何防止这种特定故障再次发生？
2.  **悲观解读**——我们如何防止这种失败的影响再次发生？

每种解释都需要不同的答案和方法。

字面上的解释就是我所说的“ [TSA](https://en.wikipedia.org/wiki/Transportation_Security_Administration) 策略”。你将预先准备好所有的应对措施，试图防止刚刚发生的特定故障再次发生。这是一种僵化的方法，不容易适应，往往会蔓延，但它可能会安抚一些提问者。“再也不会有人带着鞋子炸弹通过安检了！或者至少很少！”

**悲观解读**更符合“ [NASA](https://en.wikipedia.org/wiki/NASA) 战略”。它假设一定程度的失败，而不是试图实现 100%的预防。你将实施更侧重于恢复而非预防的应对措施。正因为如此，这种方法适用于许多不同的情况，但它可能会让人不舒服。"火箭发动机可能会熄火，但它会很快恢复."

这些方法也关注不同的度量标准。字面解释应跟踪平均故障间隔时间( [MTBF](https://en.wikipedia.org/wiki/Mean_time_between_failures) )。反过来，悲观的解释应该跟踪平均恢复时间([【MTTR】](https://en.wikipedia.org/wiki/Mean_time_to_recovery))。

## 你要用哪种解读？

如果你是 1997 年的 NT4 系统管理员，那就选择 1 吧！您管理的系统可能很大，但不一定那么复杂。服务器集群技术相当新，所以您可能没有运行任何集群，并且您的网络可能甚至没有连接到互联网。系统的复杂程度是有技术限制的。

如果你是一名工程师，试图在 2017 年管理云规模的基础设施和应用程序，那么对你同事的问题的字面解释根本行不通。您管理的系统过于复杂，无法不断增加预防措施，您永远无法掌控一切。要考虑的变量太多了。

所以你需要悲观一点。你需要假设任何事情都会失败。接受这个想法，改变你对待失败的方式。

## 先决条件

首先，你需要努力建立一个组织，或者至少是一个团队的共识，那就是试图防止你的系统中的所有失败是疯狂的。试图一个人做这件事是疯狂的。因此，尽快开始内部推销。

其次，确定系统或组件故障的“影响”意味着什么。对于最终用户来说，这意味着 404 吗？缺失交易？数据丢失？你到底想阻止什么？

第三，您需要对您的系统和应用程序有更好的可见性，因为所需的工具集最近才变得可用(除非您工作的地方足够大，您已经为此构建了自己的工具)。像 [New Relic Insights](https://newrelic.com/insights) 和 [Honeycomb](https://honeycomb.io/) 这样的产品是专门为复杂系统的分析而打造的。

传统的日志记录和指标只跟踪您所知道的故障情况。新一代工具是围绕数据发现和异常检测而构建的，帮助您找到以前看不到的模式，并构建缓解控制和自动化适应。

第四，如果你还不习惯自动化(和编码)，你需要达到这一步。复杂系统的基础设施需要自我监控和自我修复，但它也需要多少了解在其上运行的应用程序，以便它也可以帮助它们自我修复。仅靠包装盒中的零件，您可能无法完全实现这一点。

现在你至少已经让这些东西飞行了...

## 举个例子

如果你把你的想法从“我们如何防止 404 发生？”到“当系统开始检测到 404 时应该如何响应？”，你是在正确的轨道上。让我们继续这个简单的场景。

*   也许您的系统将用户引导到没有发生 404 的健康节点，并增加替换容量。
*   也许系统检测到下游的某些东西过载了，所以它在下游组件恢复时抑制 API 调用。
*   也许系统知道部署的代码的最后版本没有生成 404，所以它回滚到那个版本并发送警报。
*   也许系统会卸载，直到整体恢复。

随着您的组织在这种方法上的成熟，利用混沌工程并故意将故障引入您的系统来观察系统如何反应并建立预防性和反应性控制来解决您发现的问题可能是有意义的。“如果我们让这项服务离线，我们会收到 404 吗？没有吗？嗯，它是核心的 Nginx 路由器，所以这很奇怪。”

请注意，其中一些故障响应只是传统*预防*策略的延伸。而且，要明确的是，预防性措施仍然是需要的，它们只是变得更加基础。应该有一个基本级别的冗余，但不是一个永无止境的 it 之塔，这是大多数传统 IT 部门目前正在试图管理的。

系统的复杂性有一个临界点，在这个临界点上，反应性措施比预防措施更加实用和有效。这一直都是事实，只是云规模迫使人们不得不承认这一点。

最初发布于[chrisdodds.net](http://chrisdodds.net/design-your-systems-as-if-theyre-already-on-fire/)