# 高测试覆盖率的问题

> 原文:[https://dev . to/teamcoder/the-problem with-high-test-coverage-4dh](https://dev.to/teamcoder/the-problem-with-high-test-coverage-4dh)

上周，我参加了丹·诺斯的“测试更快”研讨会。Dan North 是术语“行为驱动开发”的创始人。整个工作坊都很棒，但有一件事让我很惊讶。由于 BDD 基本上是测试驱动开发(TDD)的另一种方式，我本以为拥有高测试覆盖率是 Dan 编写软件的目标之一。但我了解到的是，他其实并不关心整体的测试覆盖率。他以非常令人信服的方式解释了那件事。在这篇文章中，我写下了我对测试覆盖率的了解。

# [](#the-meaning-of-test-coverage)测试覆盖率的含义

测试覆盖率(也称为代码覆盖率)是一个数字，它告诉您自动化测试覆盖了多少生产代码。如果你没有任何自动化测试，那么你的测试覆盖率就是 0%。如果你的产品代码的每一行都由至少一个自动化测试执行，那么你就拥有了 100%的覆盖率。拥有一个很高的数字可能感觉很棒，但是即使是 100%也不意味着你的代码中没有错误。它只告诉你你已经为之编写测试的用例是否按预期工作。

# [](#the-cost-of-testing)测试的费用

自动化测试可以为你节省很多钱！他们可以在将错误部署到生产系统之前检测到错误，从而防止大的损害。它们还可以帮助您设计代码，使其在将来易于维护和扩展。但是编写测试不是免费的。这需要时间，而这些时间也可以用在其他事情上。丹称之为机会成本。在这一点上不要误解我。我并不是说测试是个坏主意。他们不是。事实上，它们可能非常重要。但是我想鼓励你去思考什么有意义，什么没有意义。

# [](#the-risk-plane)危险位面

那么我们如何决定测试什么呢？想象一个软件系统是这样的:
[![component graph](../Images/6f6ba8f1f7f9edd4dea72907f547f39a.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--bAYvkgf0--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://team-coder.com/wp-content/uploads/component_graph.jpg)

它们之间有许多组件和依赖关系。现在让我们给图表添加一个坐标系。一个组件越是在图表的右侧，它就越有可能断裂。某个组件的故障产生的影响越大，我们在纵轴上画得就越高。让我们来看看*风险位面* :
[![risk plane](../Images/fb58b8b3630bcdc0304a0016dd8b4796.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--ZWXCp4o4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://team-coder.com/wp-content/uploads/risk_plane.jpg)

现在假设我们系统的测试覆盖率是 80%。听起来是个不错的数字。但是看看右上角的组件。组件中很可能会有什么东西损坏，故障的影响会非常大。考虑到这一点，80%对于这部分来说实际上是相当低的。另一方面:左下角的组件很不可能坏。即使它破裂，影响也很小。那么，为了保持高的测试覆盖率，花这么多时间测试这个组件真的有意义吗？把我们的时间花在为右上角的组件编写测试甚至构建新特性上不是更有用吗？我们花在编码上的每一个小时都意味着我们公司投入的金钱。作为软件开发人员，我们有责任就如何使用这笔钱做出合理的决定。

# [](#the-stakeholder-planes)利益相关者位面

Dan North 说，“测试的目标是通过证据增加利益相关者的信心”。我们的测试可以提供证据。*增加*并不一定意味着达到 100%。它需要一些实用主义来决定在什么情况下花费多少努力。我们这样做是为了谁？是*的利益相关者*！告诉他们我们是伟大的开发者，一切都会好起来，这是不够的。我们应该给他们证据。他们应该知道哪些行为是通过测试得到保证的。开发者往往会有一个盲点。大多数开发人员认为他们的代码很棒，很有效。但是利益相关者通常对开发者没有那么大的信心，这就是他们需要证据的原因。

通常有很多种利益相关者。他们可以是用户、安全部门的人员、客户支持人员以及其他许多人。我们可以开发不太可能失败的软件，但是如果它是非法的，我们仍然不能发布它。这就是为什么我们必须用另一个轴来扩展我们的模型。我们必须为我们的利益相关者添加平面:
[![risk planes](../Images/6b6838006fa71fe88ce8b7042d7a3a15.png)](https://res.cloudinary.com/practicaldev/image/fetch/s--Ov5JmeX4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://team-coder.com/wp-content/uploads/risk_planes.jpg)

通常，涉众从不同的角度看待软件。有时候你想都没想过的方面对他们来说是必不可少的。也许某些用户角色不能访问某些数据是非常重要的。那将需要更大的测试努力。与你的各种利益相关者交谈是非常有帮助的。问他们你应该集中精力做的最重要的事情是什么。他们会在哪个部分上花费最多的精力。如果你和每一个涉众都这样做，你将会很好地了解在风险平面中何处绘制你的组件，以及在哪个组件上投入多少测试工作。

# [](#the-pragmatic-way)务实之道

Dan North 让我明白的是，测试覆盖率并不能说明软件的质量。80%对于一个组件来说可能太少，对于另一个组件来说可能是浪费时间。当我们编写代码时，我们应该首先了解我们的利益相关者。真正重要的是什么？我们应该估计潜在错误的影响和可能性，并务实地决定在哪个组件上花费多少精力。我们必须记住，我们的工作是有报酬的。我们花在编码上的每一个小时都要花钱。作为专业软件开发人员，明智地使用这笔钱是我们的责任。

*本文最初发表于[team-coder.com](https://team-coder.com/test-coverage)。*