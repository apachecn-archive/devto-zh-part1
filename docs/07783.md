# 对于 WannaCry，微软绝对有错

> 原文:[https://dev . to/mortoray/Microsoft-is-absolute-in-fault-for-wanna cry](https://dev.to/mortoray/microsoft-is-absolutely-at-fault-for-wannacry)

微软在 WannaCry 勒索病毒的破坏中发挥了重要作用。当然，近因在于恶意软件的作者，他们应该对此负责。自满的美国国家安全局在创造或发现，但未能报告利用方面也有责任。我们甚至可以说，用户必须为没有及时更新系统承担部分责任。但可以肯定的是，正是微软 Windows 操作系统的设计让攻击得以发生。

## [](#remote-code-execution)远程代码执行

WannaCry 利用了 Windows 的 SMB(文件服务器)子系统中的漏洞。它执行任意代码并控制机器。这提出了一个重要的问题:

**为什么一个负责文件共享的组件能够接管机器？**

如果我们看看 Window 的架构，就不难解释为什么这是可能的。这些子系统被视为特权用户，被赋予对计算机的广泛访问权。这才是问题的核心。缺少特权分离，并假设组件行为良好。

如果我们没有这种设计的替代方案，我们可以放微软一马。但我们确实有办法减轻这种攻击，看起来微软选择不实施它们。因此，他们必须为 WannaCry 勒索软件承担很大一部分责任。

> Windows 10 似乎没有受到恶意软件的攻击。如果这是由于实际的架构变化，正如我在这里所描述的，那就太好了！这是升级的充分理由。但不清楚事实是否如此。[安全公告](https://technet.microsoft.com/en-us/library/security/ms17-010.aspx)表明他们也为 Windows 10 上的远程代码执行打了补丁。

## [](#injecting-code)注入代码

让我们假设所有的软件都有缺陷，这些缺陷会让攻击者危及安全。鉴于我们已知的历史，这是一个不错的假设。然而，我们在写软件时继续忽略这一点。我们仍然在编码，好像系统是不可渗透的，这是一种可怕的做法。

我们需要做好防御。显然，第一道防线是更安全的编码和执行:缓冲区保护、安全类型、地址随机化等。在这个方向上有很多工作，但并不完美，所以我们必须假设我们会继续失败。

第二道防线是不允许攻击者运行任意代码。听起来这么明显，那为什么不做呢？WannaCry 攻击者通过 SMB 系统注入他们自己的代码。

CPU 有不执行和只读的内存标志。操作系统可以将可执行代码和数据内存相互分离。如果这样做了，攻击媒介就不会起作用。攻击者仍然能够破坏数据内存，但是他们没有办法进入该代码。

> CPU 并不总是有不执行的能力，但是它已经存在了 15 年了。Windows 没有使用这个功能吗？如果是，代码是如何注入的？(如果 WinXP 不支持这一功能，这也是可以理解的，因为当该操作系统发布时，它还没有得到广泛应用。)

## [](#privilege-escalation)权限升级

让我们把我们的假设扩展到完全不信任软件。一个典型的下载应用程序无法独自接管系统，为什么 SMB 组件可以呢？

考虑文件共享的一些特性:我们需要访问一组特定的文件，而不是整个文件系统；我们需要某种方法来认证用户；我们需要一种访问互联网的方法。这些都是操作系统可以提供的定义良好的接口。通过划分权限，操作系统可以限制应用程序的能力。

然而，WannaCry 恶意软件似乎已经完全控制了系统。这只有在 SMB 组件未隔离的情况下才有可能。从 Samba 中我们知道，这个协议可以作为独立的软件运行。其他操作系统上也有许多进一步隔离组件的技术。这些人都没有受雇于 Windows SMB 吗？

> 我知道改变一个操作系统的结构是一个惊人的工作量，但我必须假设微软有资源。也许他们正在这样做，但没有成功。为什么漏洞会获得如此多的系统访问权限？

## [](#and-on-and-on)等等等等

假设最坏的情况，我们所有的保护都失败了。当然我们还是可以保护用户数据的。许多文件的突然更改不是 Windows Defender 可以检测到的吗？即使没有，为什么没有回滚机制？

> 公平地说，Windows 有制作版本化备份的选项。没有启用这个是用户的错误，但是显然有什么东西阻止人们这样做。我也不确定这些备份文件是否会受到 WannaCry 的保护。

我们需要停止假设我们的计算机是安全的，而是假设它们会被破坏来进行设计。这是安全服务器设计的一个核心原则，那么为什么它没有应用于桌面系统呢？

微软在安全方面付出了很多努力，但这并不能免除他们在 WannaCry 事件中的责任。他们的系统设计允许这种攻击发生，尽管有已知的技术可以阻止它，或至少减轻严重性。