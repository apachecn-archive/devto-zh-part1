# 地雷

> 原文：<https://dev.to/rysilva/land-mines>

几年前，我接到了每个工程师都害怕的电话:生产中出现了大问题。这个问题引人注目地显现出来，但却是微妙地引起的。我通过修改一个`SQL SELECT *`查询来排除包含大量文本的列，从而显著提高了性能。那一页没用那段文字...至少我们是这么认为的。

在重构过程中，我发现文本*在一次检查中使用了*,但是在与其他工程师讨论之后，我们决定在这个查询中删除这个字段。事实证明支票很重要。几年前的某个时候，团队认为大型文本 blob 中某个子字符串的存在会以一种不明显的方式影响一个非常重要的布尔字段的值。在某些情况下，从 SQL 查询中排除该文本会影响这个重要的布尔值。

最近，我注意到一个不同的问题。我们的 API 应用了一个基于创建日期的默认设置，因为在某一天默认设置发生了变化。七个月后，我们使用第三方库的方式发生了变化，这影响了我们设置创建日期的方式，进而影响了非常具体的旧数据的设置。

这些决策——基于一大块不必要的文本中的关键字更改布尔值，基于创建日期应用设置——都是地雷。他们解决手头的问题，然后沉默数月或数年，直到某个不知情的开发人员进行例行修改时才爆发。

没有人喜欢地雷，但你如何防止它们？

**避免快捷方式**

这听起来很明显，但是走捷径继续前进是很容易的。事实上，这可能是一个地雷的象征性标志:一个为了解决问题的时间利益而做出的有问题的决定...暂时如此。但是请想想未来的你，未来的我。

**显而易见**

编写业务逻辑时，要考虑功能的输入。另一个开发人员会合理地预期输入数据的变化会影响函数的输出吗？试着想象输入数据可能发生变化的场景。这会以意想不到的方式影响输出吗？我不认为大多数人会期望设置根据创建日期而改变。

**考虑迁移**

在上面的两个例子中，引入了“脏黑客”来避免在现有数据上运行某种迁移。迁徙很可怕，我明白。但是避免迁移的结果可能更可怕。迁移是您工具箱中的一个工具，您不应该害怕使用它。在权衡各种选择时，记住要权衡迁移带来的明显风险和引入代码复杂性并可能给未来开发人员埋下地雷的不太明显的风险。

我希望这些技巧能帮助我们所有人清除代码库中的地雷。