# 明智地使用可选/可空引用类型

> 原文：<https://dev.to/bob/use-optional--nullable-reference-types-judiciously>

像 Swift、Kotlin 这样的语言在引用类型上有所区别——可选和非可选引用[或者 T2 可空和非空类型](https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/TheBasics.html#//apple_ref/doc/uid/TP40014097-CH5-ID309)——其中只有可选或可空类型可以保存 nil 或 Null 引用。

Java SE 8 也支持[可选的](http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html)，但不同之处在于，在 Swift 和 Kotlin 中，普通字段不能包含空引用。必须将它声明为可选类型才能保存空值。Java 并没有严格到允许对普通字段的空引用，但是也可以使用可选的。

所有这些类型系统都尽力避免空引用——空引用的发明者东尼·霍尔称之为“十亿美元的错误”。

如果你要从一种没有可选性的语言——比如 Java 7 或 Objective-C——转换到一种支持可选性的语言，很可能你只是把所有的字段都转换成可选的。但这不是一个很好的做法。

理解这个可选类型解决什么问题是非常重要的。与普通的空引用相比，它的优势在于可选类型迫使你或者你的 API 的客户考虑值不存在的情况。

就是这样。通过将一个字段声明为可选的，您声明了该字段可以为空，并且它使 API 的客户端处理空值的情况。

假设有一个类 Customer，它有两个字段:customerId 和 customerName。从逻辑上讲，对于任何客户，这两个字段都不能为空。

如果将这两个字段声明为可选的，则声明这些字段可以为空。而**这就产生了在运行时**让客户对象处于无效状态的可能性——也就是说，客户对象具有空的 id 或名称，但根据您的业务逻辑，它不能为空。

对象处于无效状态比空指针异常更危险，因为无效对象不会使你的应用程序崩溃，但会使你的应用程序以奇怪的方式运行，并且很难调试原因。

因此，在声明一个字段为可选字段之前，请仔细考虑该字段在逻辑上是否可以为空。如果根据您的业务逻辑，某些字段不能为空，则不要将其声明为可选字段。如果您需要声明一些逻辑上不能为空的字段作为一些特殊用例的可选字段，您可能首先必须考虑其他可能性或重新构造您的代码，而不是将可选字段作为首选。

将每个字段作为可选引用，并使用安全调用或可选链接(bob？。部门？。头？。name)来访问这些值可能会避免在开始时出现空指针异常。但是从长远来看，它会伤害到你，因为你可能会得到空值，即使对于逻辑上不能有空值的字段，也会使对象处于无效状态，更糟糕的是，你没有简单的方法来解决这个问题。