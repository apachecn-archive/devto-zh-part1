# (大)重写

> 原文：<https://dev.to/bertilmuth/big-rewrites-ba8>

莫里斯·海沃德(Maurice Hayward)问道:“如何使用不同的库、语言或技术，为切换到新的框架做出商业案例？”
我将从一个客户的真实故事开始。然后我会告诉你我从中学到了什么。
最后，我将回答关于商业案例的问题。
文章将超越原问题，解释上下文。

## 灾难

我工作过的一家成功的公司决定重写一个核心业务系统。(他们并行运行几十个不同的系统，为数百万客户提供服务。)

公司开始并行开发:在旧系统中实现新功能以服务现有客户，在新系统中实现新功能以供将来使用。

这个项目持续了几年。

该公司向大众市场推出了新系统。它坏了。它无法处理新系统架构导致的大量请求和冗长的数据传输。

公司决定终止这个项目。保留新系统的一些部分。继续运行旧系统。
项目总成本为 5 亿欧元。

## 新系统“必须做什么”

多年来，我参与了几个试图重写整个应用程序的项目。

我听到的最常见的要求是:
*新软件必须提供与旧软件相同的功能。*
当然还要加上一些额外的功能。

基于这一要求，他们提出了自己的商业案例。通常预测是:几年的努力，100 万欧元的预算。

这种情况经常发生。有时，新系统甚至不会发布。事实证明，重新实现所有现有功能是不可能的，或者成本太高。

## 我所学到的:这个商业案例是有缺陷的

新软件必须与旧软件做同样的事情的要求通常基于几个隐含的假设:

1.  我们的客户只会接受新系统，如果它的工作方式和旧系统一样，或者有更多的功能。
2.  我们需要整体开发新系统，然后发布。一个大开关。
3.  功能是重写时要考虑的最重要的方面。

以下是我的见解:如果你不经核实就做出这些假设，你就冒了很大的风险。可能导致项目失败的风险。

## 假设 1:我们的客户只会接受新系统，如果它和以前一样工作的话

最初请求某项功能的客户还在吗？即使你知道:你有数据证明客户*实际上*使用了哪些功能吗？多久一次？

即使客户使用了所有的特性:你能让工作流程更简单，让客户满意，同时减少开发工作量吗？

即使你不能简化工作流程:客户对你有多重要？也许你有其他更有价值的客户。时不时地惹恼一些人来取悦其他人也许是可以的。

也许你真的需要重新实现一切。我只是说，如果你不质疑它，你就是在冒险。

## 假设 2:我们需要整体开发新系统，然后发布。

这通常是一个巨大的风险。因为如果它失败了，你就失去了你在重写上投入的所有资金。尝试以迭代和增量的方式找到迁移到新系统的方法。

我不会在这里详细说明，但是一种方法是所谓的[扼杀者应用](https://www.martinfowler.com/bliki/StranglerApplication.html)模式。

当您开发一个新的应用程序时，已经计划好将来如何用新的技术和框架替换它的某些部分。如何做到这一点的例子有[微服务](https://martinfowler.com/articles/microservices.html)、[独立系统](http://scs-architecture.org/)或[模块化单片](https://www.youtube.com/watch?v=kbKxmEeuvc4)。

## 假设 3:在重写时，功能是最重要的考虑因素

在我看来，这个假设是最关键的。最不可能是真的。

想一想:*新软件必须提供与旧软件相同的功能。*

那你为什么要重新实现你的软件呢？你今天就可以拥有它！坚持旧制度就好了！

嗯，不。事实是:我们注意到我们的开发速度下降了。开发新功能需要越来越多的时间，或者
B .我们现有的系统无法服务不断增长的用户数量，或者
C .可用性很恐怖，或者
D .性能很差，或者
E .以上任意组合。

现在我们在谈话。

## 对商业案例进行重写

在大多数情况下，重写的真正原因是:质量需求。
有时也称为“感受力”。

还有一些外在的品质，比如:可用性、可靠性、性能。你的软件用户可以观察到这些品质。他们会把顾客赶跑给你的竞争对手。它们会导致你的产品在市场上失败(见第一个故事)。

然后，还有内在素质。你需要多长时间来扩展软件？即使没有图形用户界面，你能容易地自动测试它吗？用一个数据库替换另一个数据库需要多少努力？团队可以在不与其他团队协调的情况下快速部署到生产环境中吗？

这些内在品质也很重要。它们会影响上市时间。和开发者快乐。

所以我的建议是:使质量需求可测量，并以此为基础建立你的商业案例。即使您“只是”迁移到一个新的框架或选择一项新技术。作为开发人员，我们倾向于采用最新的、闪亮的技术。相反，你应该能够从*商业角度*描述好处。

## 举个例子

假设您注意到，随着时间的推移，您的软件变得难以更改。

你应该问自己:

*   某项功能对您的企业有多重要？
*   在您的代码库中，对该特性或与之相关的特性进行更改的频率如何？
*   通过重写特性，您可能会节省多少开发工作量？

因此，假设某个特性对您的业务来说不太重要。多年来一直没有改变，贵公司近期也没有改变的计划。您可以决定现在不重写该特性。这是一个商业决定。

假设一个重要的特性在去年已经改变了 5 次。每次，你的团队平均要花 6 天的时间来改变这个特性。如果您只有适当的配置和自动化，您可以将工作量减少到 1 天。这理由还不够重写吗？

好吧，我们来算算。5 x 6 天就是 30 天，减去 5 x 1 天。25 天。假设变化率保持不变，这就是你下一年重写的开发预算。你需要估计你是否会保持在这个阈值以下。

这是你的商业案例。

## 所有的模型都是错误的，有些是有用的

我知道这是一个简单化的模型。你不会从中得到确切的结果。还有更复杂的模型，比如[延迟成本](https://en.wikipedia.org/wiki/Cost_of_delay)。

此外，我假设特性是独立重写的，但事实往往并非如此——例如当迁移到一个新的框架时。

那些计算给你的感觉是:值得努力吗？

如果你不能独立重写:首先关注一小部分范围。创建一个原型，重写一些特性，如果你的假设成立，你会有一种感觉。

“如果我们使用这个新框架，我们的性能是否可以接受？让我们用越来越多的用户对一个/几个功能进行压力测试，看看它什么时候崩溃。”然后将其与您的实际用户数量进行比较。

当你决定要不要去做微服务的时候，去和企业谈。他们真正需要的功能上市时间有多长？
交付时间的缩短是否证明投资额外的技术复杂性是合理的？

## 大概就是这样。

莫里斯，你是第一个对我的请求发表评论的人。谢谢你。
希望我的回答对你有用。

致所有读者:我希望你觉得有趣。很高兴听到你的评论和自己的经历。