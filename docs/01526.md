# 评论我的计划:用于身份验证的 API 密钥

> 原文：<https://dev.to/imthedeveloper/critique-my-plan-api-key-for-authentication-26i5>

我正沉迷于一个网络浏览器游戏，想把我的注意力从开发工作上转移几个小时。似乎玩这个游戏的社区是用户脚本的大粉丝，允许他们改变 UI 的某些方面。许多社区还拥有自己的服务器，这使得他们可以在游戏之外组织和添加结构。

作为一个真正的开发者，我也成为了其中的一员。托管我自己的额外系统，制作我自己的脚本，用新数据增强游戏体验。

我正在寻找从我自己的服务器传递数据的安全方法，一旦用户登录游戏，通过用户脚本将数据传递到用户的浏览器。他们的浏览器和我的系统工具之间的实时链接将允许上下文相关和个性化的数据被注入到他们的游戏中，如实时统计。

由于我只有一个用户脚本的选项，这个游戏没有开放的 API，我想通过使用他们从我的系统(一旦登录)生成的用户 API 密钥来验证用户，然后一旦他们登录到游戏，我可以通过一个表单请求这个密钥来验证他们的浏览器对我的 API 端点的任何后续调用。

我有几个问题，老实说，我绝对喜欢这样的工作，因为它让我在日常工作中获得我认为理所当然的领域的知识。我把它们列在下面，如果其他人也能分享他们的想法和经历，那就太好了。

#### API 密钥生成

我做了一些研究，我最初的想法是使用 UUID 作为 API 键，这引发了 StackExchange 中一些有趣的对话。UUID 生成有时熵太小，这意味着为了确保攻击者不只是循环生成和尝试这些 ID，我还应该在此基础上添加一些加密。我见过很多哈希、加盐、base64 编码的方法，然后我偶然发现了这个[https://www.npmjs.com/package/generate-safe-id](https://www.npmjs.com/package/generate-safe-id)我认为这是我需要考虑的唯一问题，对吗？

#### API 密钥 vs API 秘密

这是一个相当开放的问题。我注意到在现实世界中处理某些 API 时，它们经常显示一个 API 密钥和一个 API 秘密。两者区分的目的是什么？

#### API 密钥用法/策略

我不打算在我的 API 键中存储任何信息，它纯粹是一个没有冲突的随机字符串(我希望),我可以通过我的中间件策略来查找发出请求的用户，并检查他们的访问级别/从这样的键中查找他们的配置文件。这里有什么更好的方法吗？我想要一些轻量级的东西，JWT 和元数据的使用对我来说似乎有些过头了。

#### API 密钥存储(客户端)

在客户端存储 API 密匙有什么意义？因为我是通过我的用户脚本有效地注入代码，所以我可以选择将密钥存储在 cookie 或本地存储中。哪个对持久性更好，或者哪个是典型的最佳实践？

#### API 密钥存储(服务器端)

我计划允许用户登录到我的系统，并找到他们的个人资料页面，在那里他们可以生成他们唯一的 API 密钥。然后，我将根据他们配置文件存储密钥，如果他们愿意，可以选择重新生成(撤销旧的)。作为一名管理员，我也可以根据自己的意愿重新生成/删除密钥。对于 API 键的存储，我认为完全可以将它“原样”存储在我的 DB 中，不需要任何额外的散列。原因是，如果攻击者可以访问数据库，那么我会有更大的问题，但我也希望保持这种轻量级，在我的中间件策略检查期间的任何解密都会增加请求的开销。这听起来像是明智的做法吗？

#### 认证与授权

处理用户浏览器的认证是一回事，但你不能忽视授权。如前所述，我将使用 API 密钥根据存储在我的数据库中的配置文件来验证用户。在中间件策略检查期间，将检索用户配置文件，然后我将检查他们是否具有“成员”或更高的访问级别。对于那些拥有与配置文件无关的密钥的用户，以及那些返回具有“member”以下访问权限的配置文件的请求，我将只发送一个 403 禁止响应给请求。据我所知，这应该满足我的授权需求，但是我还应该进行其他实践/检查吗？我在考虑使用浏览器指纹来检查密钥是否被最初保存密钥的浏览器使用。